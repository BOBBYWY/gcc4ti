<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<TITLE>Frequently Asked Questions</TITLE>
<STYLE TYPE="TEXT/CSS">
<!--
.IE3-DUMMY { CONT-SIZE: 100%; }
BODY { FONT-FAMILY: Verdana,Arial,Helvetica,Sans-Serif; BACKGROUND-COLOR: #E0E0E0; }
P { FONT-FAMILY: Verdana,Arial,Helvetica,Sans-Serif; }
H1 { FONT-FAMILY: Verdana,Arial,Helvetica,Sans-Serif; }
H2 { FONT-FAMILY: Verdana,Arial,Helvetica,Sans-Serif; }
H3 { FONT-FAMILY: Verdana,Arial,Helvetica,Sans-Serif; }
H4 { FONT-FAMILY: Verdana,Arial,Helvetica,Sans-Serif; }
H5 { FONT-FAMILY: Verdana,Arial,Helvetica,Sans-Serif; }
H6 { FONT-FAMILY: Verdana,Arial,Helvetica,Sans-Serif; }
UL { FONT-FAMILY: Verdana,Arial,Helvetica,Sans-Serif; }
TD { FONT-FAMILY: Verdana,Arial,Helvetica,Sans-Serif; BACKGROUND-COLOR: #FFFFFF; }
.NOBORDER { BACKGROUND-COLOR: #E0E0E0; PADDING: 0pt; }
.NOBORDER TD { FONT-FAMILY: Verdana,Arial,Helvetica,Sans-Serif; BACKGROUND-COLOR: #E0E0E0; PADDING: 0pt; }
.CODE { FONT-FAMILY: Courier New; }
-->
</STYLE>
</HEAD>
<BODY TEXT="#000000" BGCOLOR="#E0E0E0">
<FONT SIZE="5"><B>Frequently Asked Questions</B></FONT>
<HR>
<P>The FAQ list is organized into several categories. In each category, you will see a list of
commonly asked questions in short form. Please click on a question that interests you to get the full form
of the question and the related answer. Note, however, that some questions/answers are related to each other, and some
answers are logical consequences of previous ones. So, after reading the answer, it is recommended
to browse through surrounding quesion/answer pairs too, to get some more information.
<BR><BR>
Also, please visit the <A HREF="http://tichessteamhq.yuku.com">TICT &amp; TIGCC/GCC4TI Programming Message Board</A>
and the <A HREF="http://www.yaronet.com/gcc4ti"><B>GCC4TI message board</B></A>.
A lot of interesting topics about TIGCC/GCC4TI programming are discussed there.</P>

<UL>
<LI><B><A HREF="#language">The C Language</A></B>
<LI><B><A HREF="#tibasic">TI-Basic and C</A></B>
<LI><B><A HREF="#graphics">Graphics and Display</A></B>
<LI><B><A HREF="#assembly">Assembly and C</A></B>
<LI><B><A HREF="#strings">Strings</A></B>
<LI><B><A HREF="#events">Event-driven Programming, Menus, and Throwing Errors</A></B>
<LI><B><A HREF="#vat">TI Variables and the Variable Allocation Table (VAT)</A></B>
<LI><B><A HREF="#memory">Memory, C Variables, and Pointers</A></B>
<LI><B><A HREF="#input">Input: Keyboard and Link</A></B>
<LI><B><A HREF="#misc">Miscellaneous</A></B>
</UL>
<HR>
<H2><A NAME="language"><U>The C Language</U></A></H2>
<UL>
<LI><B><A HREF="#1">Where can I learn more about C?</A></B>
<LI><B><A HREF="#5">Will you implement C++?</A></B>
<LI><B><A HREF="#7">I get weird error messages where I don't see errors.</A></B>
<LI><B><A HREF="#10">Why do I get &quot;Undefined Reference to...&quot; errors?</A></B>
<LI><B><A HREF="#20">How can I make a floating point comparison function for use with qsort?</A></B>
<LI><B><A HREF="#41">Why do I get the message &quot;invalid lvalue in unary '&amp;'&quot;?</A></B>
<LI><B><A HREF="#46">Can I use # (indirection) like in TI-Basic?</A></B>
<LI><B><A HREF="#47">I need the C equivalent of the when() function from TI-Basic.</A></B>
<LI><B><A HREF="#81">I tried to use sizeof to get the size of an object, but it returned zero!</A></B>
<LI><B><A HREF="#82">Can I use sizeof to determine the exact size of functions?</A></B>
</UL>
<HR>
<H2><A NAME="tibasic"><U>TI-Basic and C</U></A></H2>
<UL>
<LI><B><A HREF="#4">RETURN_VALUE doesn't work on AMS 2.xx!</A></B>
<LI><B><A HREF="#21">How can I display a PIC variable created in TI-Basic?</A></B>
<LI><B><A HREF="#50">How can I execute TI-Basic programs or statements from C?</A></B>
<LI><B><A HREF="#61">Can I write a program that returns a value to TI-Basic?</A></B>
<LI><B><A HREF="#62">Why is 'a=GetIntArg (top_estack);' wrong?</A></B>
<LI><B><A HREF="#63">How can I get a value from a TI-Basic matrix element?</A></B>
<LI><B><A HREF="#64">How can I make my C function return itself?</A></B>
</UL>
<HR>
<H2><A NAME="graphics"><U>Graphics and Display</U></A></H2>
<UL>
<LI><B><A HREF="#18">How can I display a number variable on the screen (like an int)?</A></B>
<LI><B><A HREF="#101">Do you plan on implementing 7-level grayscale?</A></B>
<LI><B><A HREF="#14">How can I use sprites?</A></B>
<LI><B><A HREF="#15">I don't understand how to define sprites!</A></B>
<LI><B><A HREF="#17">How do you use sprite functions from sprites.h with grayscale?</A></B>
<LI><B><A HREF="#22">How does BitmapGet work?</A></B>
<LI><B><A HREF="#39">How can I create a virtual screen?</A></B>
<LI><B><A HREF="#40">How can I set up a SCR_RECT structure?</A></B>
<LI><B><A HREF="#42">How can I make a WINDOW structure?</A></B>
<LI><B><A HREF="#43">How do I use functions from the wingraph.h file?</A></B>
<LI><B><A HREF="#44">How do you use DrawIcon?</A></B>
<LI><B><A HREF="#45">I need a really fast line-drawing routine...</A></B>
<LI><B><A HREF="#67">I can't reset printf to start at the top of the screen!</A></B>
<LI><B><A HREF="#85">How can you disable the 2nd and alpha indicators at the bottom of the screen?</A></B>
<LI><B><A HREF="#86">When I disable interrupts, grayscale doesn't work!</A></B>
<LI><B><A HREF="#87">While I was fiddling with interrupt handlers...</A></B>
</UL>
<HR>
<H2><A NAME="assembly"><U>Assembly and C</U></A></H2>
<UL>
<LI><B><A HREF="#13">How can I use a kernel-based libraries in C?</A></B>
<LI><B><A HREF="#88">How can I communicate between ASM and C code?</A></B>
</UL>
<HR>
<H2><A NAME="strings"><U>Strings</U></A></H2>
<UL>
<LI><B><A HREF="#35">How do you use strcat properly?</A></B>
<LI><B><A HREF="#19">How can I write an efficient number to string routine?</A></B>
<LI><B><A HREF="#105">Why can't I use a backslash (e.g. &quot;main\var&quot;) in my strings?</A></B>
</UL>
<HR>
<H2><A NAME="events"><U>Event-driven Programming, Menus, and Throwing Errors</U></A></H2>
<UL>
<LI><B><A HREF="#23">If my program throws an error, I can't start it again!</A></B>
<LI><B><A HREF="#59">Can dialogs have popup menus with submenus?</A></B>
<LI><B><A HREF="#77">Why does calling the previous event handler in a user event handler result in a crash?</A></B>
<LI><B><A HREF="#78">How can I use functions in textedit.h to edit a text variable?</A></B>
<LI><B><A HREF="#79">I tried to create a new window for the text editor, but it didn't work...</A></B>
<LI><B><A HREF="#80">Can you change the font in the text editor?</A></B>
<LI><B><A HREF="#58">Why isn't it possible to create menus with more than one level of submenu with PopupAddText, and how can I do it anyway?</A></B>
<LI><B><A HREF="#60">How can I use VTI to pick bytes from menu structures like you describe?</A></B>
</UL>
<HR>
<H2><A NAME="vat"><U>TI Variables and the Variable Allocation Table (VAT)</U></A></H2>
<UL>
<LI><B><A HREF="#51">How can I get a list of all the variables/folders on the calculator?</A></B>
<LI><B><A HREF="#52">How can I determine the type and size of a variable?</A></B>
<LI><B><A HREF="#53">How can I copy a variable from one folder to another?</A></B>
<LI><B><A HREF="#54">How can I create a List or Matrix variable to keep highscores or similar information?</A></B>
<LI><B><A HREF="#55">Can I create a variable with a custom type (like HSC for highscores)?</A></B>
<LI><B><A HREF="#56">I want to create a variable without using functions from stdio.h.</A></B>
<LI><B><A HREF="#84">When I use functions from vat.h, the calculator crashes!</A></B>
</UL>
<HR>
<H2><A NAME="memory"><U>Memory, C Variables, and Pointers</U></A></H2>
<UL>
<LI><B><A HREF="#25">I have trouble allocating memory, my program crashes on the second run.</A></B>
<LI><B><A HREF="#26">I can't understand C matrices!</A></B>
<LI><B><A HREF="#28">How do I store variables so they retain their values, like for highscores?</A></B>
<LI><B><A HREF="#29">Global variables retain value?</A></B>
<LI><B><A HREF="#30">How can you control where data is stored in memory and access it?</A></B>
<LI><B><A HREF="#31">What is so horrible about global variables?</A></B>
<LI><B><A HREF="#32">How can you store a number such as 0x4c00 in a pointer?</A></B>
<LI><B><A HREF="#33">Is it possible to add one or two bytes to a longword pointer?</A></B>
<LI><B><A HREF="#34">Why can't you assign values to dereferenced void pointers?</A></B>
<LI><B><A HREF="#36">How can I have large global variables that don't take up space in my program file?</A></B>
<LI><B><A HREF="#37">How can I create a dynamic two-dimensional array?</A></B>
<LI><B><A HREF="#38">How can I create variable-size arrays?</A></B>
<LI><B><A HREF="#99">Why do I get &quot;Value computed is not used&quot; when working with pointers?</A></B>
</UL>
<HR>
<H2><A NAME="input"><U>Input: Keyboard and Link</U></A></H2>
<UL>
<LI><B><A HREF="#68">How can I get input from the keyboard?</A></B>
<LI><B><A HREF="#57">I'm having trouble with the functions from link.h...</A></B>
<LI><B><A HREF="#69">Do you have the function that gets called when you do InputStr in TI-Basic?</A></B>
<LI><B><A HREF="#70">How can I make a keyboard input function that allows you to bring up the CHAR menu (or MATH, etc)?</A></B>
<LI><B><A HREF="#71">I'm having trouble with the OSGetStatKey function.</A></B>
<LI><B><A HREF="#72">How can I read the keyboard faster than ngetchx, but easier than _rowread?</A></B>
<LI><B><A HREF="#73">How can I get the key repetition feature to work using the keyboard queue?</A></B>
<LI><B><A HREF="#74">Why are ngetchx and kbhit so slow?</A></B>
<LI><B><A HREF="#75">Is there a function like the idle_loop function?</A></B>
<LI><B><A HREF="#76">How can I bring up the VAR-LINK dialog and get the name of the selected file?</A></B>
<LI><B><A HREF="#98">I'm having troubles while reading I/O ports!</A></B>
</UL>
<HR>
<H2><A NAME="misc"><U>Miscellaneous</U></A></H2>
<UL>
<LI><B><A HREF="#9">Some of your examples don't compile!</A></B>
<LI><B><A HREF="#12">Why do you use -O2/-Os when -O3 performs better optimization?</A></B>
<LI><B><A HREF="#83">I need to access the FLASH memory.</A></B>
<LI><B><A HREF="#24">Some functions with no arguments (like 'off') don't work for me!</A></B>
<LI><B><A HREF="#48">How can I detect the hardware version of the calculator?</A></B>
<LI><B><A HREF="#65">How can I use very large integers like TIOS?</A></B>
<LI><B><A HREF="#66">I need the gotoxy() function to port PC programs to the calculator...</A></B>
<LI><B><A HREF="#49">How can I create a program that is bigger than 24K and works on AMS 2.xx?</A></B>
<LI><B><A HREF="#102">What might be the reason for my program leaking a small amout of memory?</A></B>
<LI><B><A HREF="#103">What is an &quot;Address Error&quot;?</A></B>
<LI><B><A HREF="#104">Why does my program using dialog boxes crash?</A></B>
</UL>
<HR>
<H3><A NAME="1"><U>Where can I learn more about C?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Is there any examples available on the net from which it is possible to
learn something more...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
The best solution would be if I wrote a tutorial. Unfortunately, I have
not enough time to write tutorials, small examples, etc. Some examples come
with TIGCC starting from release 0.6, but this is probably not enough. I know that some
people work on making a tutorial, but as far as I know, all of them are
in a very early state. I suggest first learning C language (not C++) on some big
computer (PC, Mac, etc.). A very good list of generic C language tutorials may be found
on the <A HREF="http://tict.ticalc.org">TI-Chess Team Home Page</A>. After learning the basics
of C, reading the documentation of GCC4TILIB will be enough to learn how to apply this
to TI programming. In addition, try looking at my programs like
creversi, cblaster and scott (scott is in the advint.zip archive); all of them are
in the TI-89 assembly games directory on ticalc.org. Note that every day the number of TI
programs written in C increases, so now there are lots of open-source C programs
which can be found on ticalc.org.
</TD></TR></TABLE></P>

<H3><A NAME="5"><U>Will you implement C++?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I learn C++ in a school so it will be good if I can program my TI-89 in C++ (not in
ordinary C). Do you plan to implement C++ on TI-89?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
No. Although C++ is more powerful language than C, it is not a language which is
good for TI calculators. It is not efficient enough to be good for a calculator.
The code generated by C++ is less efficient than code
generated by ordinary C, and it is too bloated. So, even if somebody made C++
compiler for TI, I don't recommend using any C++ extensions (like classes, and
especially streaming), except if you like programs like</P>
<PRE>cout &lt;&lt; "Hello world";
</PRE>
<P>which produces 5 Kb long code...
</TD></TR></TABLE></P>

<H3><A NAME="7"><U>I get weird error messages where I don't see errors.</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
The compiler sometimes report strange error messages on places where I really can not see
any errors. For example, the compiler reports the error</P>
<PRE>parse error before 'void'
</PRE>
<P>but the statement on which the error is reported was</P>
<PRE>int cexp;
</PRE>
<P>I am really confused. First, I don't see any errors here, and second, I can't see any 'void'
keywords here!
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Yes, such problems may really be the source of big frustrations. There is nothing wrong with
above statement, but note that <CODE>'cexp'</CODE> is a function defined in
<A HREF="timath.html">timath.h</A> header file, and you can not use this name as a name
of a variable. Now you can say why you got such strange error message? See, the most of
functions in GCC4TILIB are translated by the <A HREF="cpp.html">preprocessor</A> into constructions which perform
indirect function calls through a TIOS jump table. In other words, <CODE>'cexp'</CODE> will
be replaced by the preprocessor into the indirect function call constructor whenever it is
used. So, the innocent statement like</P>
<PRE>int cexp;
</PRE>
<P>will be converted into</P>
<PRE>int (*(void(**)(float,float,float*,float*))(*(long*)0xC8+1316));
</PRE>
<P>which is a syntax error. And the error is just before <CODE>'void'</CODE>.
<BR><BR>
I can not do anything against such hidden errors. Whenever you encounter strange errors without
obvious reasons, check whether you used reserved library name for your identifier. The chance
of making such errors is much smaller if you include only the necessary header files than if you
include the general header file <A HREF="tigcclib.html">tigcclib.h</A>.
</TD></TR></TABLE></P>

<H3><A NAME="10"><U>Why do I get &quot;Undefined Reference to...&quot; errors?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
When I tried to compile my program, the linker reports to me</P>
<PRE>Undefined reference to&nbsp;...</PRE>
<P>although my program seems correct. What's a problem?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Either something is wrong with your program (more probably you used a function which is not
defined elsewhere, maybe due to typing error), or you used something which is not yet
implemented yet in GCC4TI (which is probably true if you got an undefined reference to a
symbol which begins which the double underscore
<CODE>'__'</CODE>). For example, although
GCC4TI supports very long (64-bit) integers (<CODE>'long&nbsp;long'</CODE> type, which is a
<A HREF="gnuexts.html">GNU C extension</A>), the support for multiplying and dividing double
longs is not supported yet. For example, if you try to divide two double-long numbers, you
will get an undefined reference to <CODE>'__udivdi3'</CODE>. Sorry, there is no simple help
for this. You must live without 64-bit division for now. It may be implemented in
the future.
</TD></TR></TABLE></P>

<H3><A NAME="20"><U>How can I make a floating point comparison function for use with qsort?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
How I can define a comparison function for sorting an array of floats using
<A HREF="stdlib.html#qsort">qsort</A> function:
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Here is a simple example (called "Sort Floats"):</P>
<PRE>// Sort a list of floating point values

#define USE_TI89              // Compile for TI-89
#define USE_TI92PLUS          // Compile for TI-92 Plus
#define USE_V200              // Compile for V200

#define MIN_AMS 100           // Compile for AMS 1.00 or higher
#define SAVE_SCREEN           // Save/Restore LCD Contents

#include &lt;tigcclib.h&gt;         // Include All Header Files

// Comparison Function
CALLBACK short flt_comp(const void *a, const void *b)
{
  return fcmp (*(const float*)a, *(const float*)b);
}

// Main Function
void _main(void)
{
  float list[5] = {2.5, 3.18, 1.42, 4.0, 3.25};
  int i;
  clrscr ();
  qsort (list, 5, sizeof (float), flt_comp);
  for (i = 0; i &lt; 5; i++)
    printf (&quot;%f\n&quot;, list[i]);
  ngetchx ();
}
</PRE>
<P></TD></TR></TABLE></P>

<H3><A NAME="41"><U>Why do I get the message &quot;invalid lvalue in unary '&amp;'&quot;?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Well, I need to know more about lvalues and GNU C initializers and cast
constructors. Especially, I need to know why I sometimes get an error
message "invalid lvalue in unary '&amp;'"...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Click <A HREF="gnuexts.html">here</A> to see everything about GNU C
extensions. But if you are lazy to read too much, I will be more concrete
here. First, in GNU C (GCC4TI is GNU C), initializers may be non-constants.
For example,</P>
<PRE>int a = 3, b = 4, c = 5, d = 6;
int array[4] = {a, b, c, d};
</PRE>
<P>is quite legal. That's why</P>
<PRE>int a = 3, b = 4, c = 5, d = 6;
SCR_RECT myScr = {{b + a, b - a, d + c, d - c}};
</PRE>
<P>is quite legal too. Second, GNU C has one very nice
extension in addition to ordinary C: cast constructors. This is a
method for constructing structures, arrays, unions etc. "on fly" by
using a typecasting of an initializer to an appropriate data type, for
example</P>
<PRE>(SCR_RECT){{10, 10, 50, 50}}
</PRE>
<P>So, you can use</P>
<PRE>SCR_RECT myScr;
...
myScr = (SCR_RECT){{10, 10, 50, 50}};
</PRE>
<P>which is impossible in ordinary C (ANSI C). You can even use</P>
<PRE>myScr = (SCR_RECT){{a, b, c, d}};
</PRE>
<P>where a,b,c,d are expressions. Well, but what is now the problem?
See, C has two type of objects: lvalues and non-lvalues. lvalues
are objects which may appear on the left size of an assignment.
For example, a variable is an lvalue and a constant is not an lvalue,
because <CODE>'x=5'</CODE> is legal and <CODE>'5=x'</CODE>
(or <CODE>'5=3'</CODE>) is not legal. Not only variables are lvalues;
for example, dereferenced pointers are also lvalues, so this is legal
for example (store 100 at address 0x4c00):</P>
<PRE>*(char*)0x4c00 = 100;
</PRE>
<P>So, <CODE>'*(char*)0x4c00'</CODE> is an lvalue. Now, about the problem. In GNU C,
cast constructors are lvalues only if the initializer is completely
constant. I.e. <CODE>'(SCR_RECT){{10,10,50,50}}'</CODE> is an lvalue, but
<CODE>'(SCR_RECT){{a,b,c,d}}'</CODE> is not. As C language accepts unary '&amp;'
operator (i.e. "address of") only on lvalue objects, this means
that, for example,</P>
<PRE>&amp;(SCR_RECT){{10, 10, 50, 50}}
</PRE>
<P>is legal, but</P>
<PRE>&amp;(SCR_RECT){{a, b, c, d}}
</PRE>
<P>is not! This is the real cause of the problem!!!
<BR><BR>
What you can do if you need an address of non-constant cast constructor? You need
to declare an auxilary variable. For example, declare one
<A HREF="graph.html#SCR_RECT">SCR_RECT</A> variable, say myScr,</P>
<PRE>SCR_RECT myScr;
</PRE>
<P>and instead of</P>
<PRE>ScrRectFill (&amp;(SCR_RECT){{a, b, c, d}}, ScrRect, A_XOR);
</PRE>
<P>use:</P>
<PRE>myScr = (SCR_RECT){{a, b, c, d}};
ScrRectFill (&amp;myScr, ScrRect, A_XOR);
</PRE>
<P>Note that <CODE>'&amp;myScr'</CODE> is legal, because <CODE>'myScr'</CODE> is
an lvalue (it is an ordinary variable). I hope that this helps a lot
understanding of cast constructors and lvalues.
</TD></TR></TABLE></P>

<H3><A NAME="46"><U>Can I use # (indirection) like in TI-Basic?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I wonder how I can simulate the indirection operator (<CODE>'#'</CODE>) from
TI-Basic in C programs...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Nothing equivalent to indirection (<CODE>'#'</CODE>) exists in any compiling
language (like C), since the variable names do not appear in the compiled
program. You need to make up your mind to avoid this operator.
For indirect references to variables in C, you can use
<A HREF="opers.html#asterisk">pointers</A>. However, usually you can
re-express the code using multiple
<CODE><A HREF="keywords.html#if">if</A></CODE>-<CODE><A HREF="keywords.html#if">else</A></CODE>
statements or arrays. Don't be afraid, C will process it 1000 times faster
than TI-Basic processes indirections.
</TD></TR></TABLE></P>

<H3><A NAME="47"><U>I need the C equivalent of the when() function from TI-Basic.</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I need the C equivalent of the <CODE>'when()'</CODE> function from TI-Basic.
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
This is simple:</P>
<PRE>when (<I>condition</I>, <I>true_val</I>, <I>false_val</I>)
</PRE>
<P>is translated to C as</P>
<PRE><I>condition</I> ? <I>true_val</I> : <I>false_val</I>
</PRE>
<P>For example,</P>
<PRE>sign = x &gt;= 0 ? 1 : -1;
</PRE>
<P>Happy?
</TD></TR></TABLE></P>

<H3><A NAME="81"><U>I tried to use sizeof to get the size of an object, but it returned zero!</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
When I tried to use the <A HREF="keywords.html#sizeof">sizeof</A> operator to determine the
exact size of some objects, I got zero as the result. What is wrong?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
You probably tried something like</P>
<PRE>printf ("%d", sizeof (<I>something</I>));
</PRE>
<P>The ANSI standard proposes that the <A HREF="keywords.html#sizeof">sizeof</A> operator returns
a value of type <A HREF="stddef.html#size_t">size_t</A>, which is in fact long integer in
this implementation. So, the result is pushed on the stack as a long integer, but the format
specifier "%d" expects an ordinary integer, so it pulls from the stack just one word, which
is zero in this case. You need to write</P>
<PRE>printf ("%ld", sizeof (<I>something</I>));
</PRE>
<P>Alternatively, you can use a typecast to convert the result to a short integer</P>
<PRE>printf ("%d", (short) sizeof (<I>something</I>));
</PRE>
<P>assuming that no object would be longer that 32767 bytes.
</TD></TR></TABLE></P>

<H3><A NAME="82"><U>Can I use sizeof to determine the exact size of functions?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Is it possible to determine the size of the function using the
<A HREF="keywords.html#sizeof">sizeof</A> operator?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
No. In "normal" programs you should never know this information.
ANSI C even does not propose what is <CODE>'sizeof(<I>function</I>)'</CODE>, and such
construction will be rejected by the most of C compilers.
GNU C (like GCC4TI is) uses <A HREF="gnuexts.html#SEC79">extended pointer arithmetic</A>
on such way that <CODE>'sizeof(<I>function</I>)'</CODE> is always 1. If you are a dirty
hacker (as I am), and if you really need to determine the number of bytes occupied by
function, I used the following method:</P>
<PRE>void MyFunction(void)
{
  // <I>The function body...</I>
}
void End_Marker(void);
asm("End_Marker:");
...
...
num_of_bytes = (char*)End_Marker - (char*)MyFunction;
</PRE>
<P>Note however that this method is not absolutely reliable, because it depends of the ordering of
functions in the program. But, the compiler is free to change the order of functions
if such reorganization may lead to a better code.
</TD></TR></TABLE></P>

<HR>
<H3><A NAME="4"><U>RETURN_VALUE doesn't work on AMS 2.xx!</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I have problems with programs which return values to the TI-Basic using
<A HREF="htretval.html">RETURN_VALUE</A> directive!
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Yes, this is a problem with AMS 2.xx. For some strange reasons AMS 2.xx
does not allow ASM programs to be part of expressions any more, i.e. if
<CODE>'xyz'</CODE> is an ASM program, <CODE>'xyz(3,2)+5'</CODE> or
<CODE>'xyz(3,2)-&gt;a'</CODE>
is not legal in AMS 2.xx. Fortunately, there is a solution. Read what I wrote about this
problem in the section <A HREF="htretval.html">How to return values to the TI-Basic</A>.
</TD></TR></TABLE></P>

<H3><A NAME="21"><U>How can I display a PIC variable created in TI-Basic?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Is it hard to display a PIC variable created from TI-Basic in C programs?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
No, it is easy. It is enough to locate the variable (using <A HREF="vat.html#SymFind">SymFind</A>
for example), and to display its content using <A HREF="graph.html#BitmapPut">BitmapPut</A> (its
contents are just as expected by <A HREF="graph.html#BitmapPut">BitmapPut</A> function). To be
more concrete, look at the following function:</P>
<PRE>short show_picvar (SYM_STR SymName, short x, short y, short Attr)
{
  SYM_ENTRY *sym_entry = SymFindPtr (SymName, 0);
  if (!sym_entry) return FALSE;
  if (peek (HToESI (sym_entry-&gt;handle)) != PIC_TAG) return FALSE;
  BitmapPut (x, y, HeapDeref (sym_entry-&gt;handle) + 2, ScrRect, Attr);
  return TRUE;
}
</PRE>
<P>The usage of this function is straightforward, for example:</P>
<PRE>show_picvar (SYMSTR ("testpic"), 30, 30, A_NORMAL);
</PRE>
<P>assuming that "testpic" is the name of the wanted PIC variable. This function returns
<A HREF="alloc.html#Bool">TRUE</A> if the operation was successful, else returns
<A HREF="alloc.html#Bool">FALSE</A> (i.e. the picvar does not exist, or it is not
a PIC variable).
</TD></TR></TABLE></P>

<H3><A NAME="50"><U>How can I execute TI-Basic programs or statements from C?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Is there any way to execute a file (i.e. another ASM or TI-Basic program) from a C program?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
There are a lot of methods for doing this.
The most obvious method to do this is usage of a function like this one:</P>
<PRE>void progrun(const char *name)
{
  char fname[25];
  HANDLE h;
  strcpy (fname, name);
  strcat (fname, "()");
  push_parse_text (fname);
  h = HS_popEStack ();
  TRY
    NG_execute (h, FALSE);
  FINALLY
    HeapFree (h);
  ENDFINAL
}
</PRE>
<P>The usage of it is straightforward, for example:</P>
<PRE>progrun ("testprog");
</PRE>
<P>Note that the program you call may throw errors. If you understand this function, you can easily expand it
to accept arguments, etc. Principally, using <A HREF="estack.html#NG_execute">NG_execute</A>
you can execute any particular sequence of TI-Basic statements.
</TD></TR></TABLE></P>

<P>See also: <A HREF="#49">How can I create a program that is bigger than 24K and works on AMS 2.xx?</A></P>
<H3><A NAME="61"><U>Can I write a program that returns a value to TI-Basic?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Is it possible to write a program which will return a value to TI-Basic, i.e. which
acts like functions in TI-Basic?
<BR><BR>
This is easy, was implemented a long time ago, and is described on the
starting page of the documentation.
</TD></TR></TABLE></P>

<H3><A NAME="62"><U>Why is 'a=GetIntArg (top_estack);' wrong?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
What is wrong in doing</P>
<PRE>a = GetIntArg (top_estack);
</PRE>
<P>It seems that it works fine, but you always use an auxilary variable...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
It works fine sometimes, but not always. See, <A HREF="args.html#GetIntArg">GetIntArg</A>
is a function-looking macro, with <B>changes</B> the value of its actual
argument. So, if you write</P>
<PRE>a = GetIntArg (top_estack);
</PRE>
<P>you will also change the value of TIOS system variable <A HREF="estack.html#top_estack">top_estack</A>,
and I am not sure that you really want this. So, I strictly recommend using an auxilary variable,
like in the following example:</P>
<PRE>ESI argptr = top_estack;
...
a = GetIntArg (argptr);
</PRE>
<P>Using this method, you will avoid unexpected changes of <A HREF="estack.html#top_estack">top_estack</A>.
</TD></TR></TABLE></P>

<H3><A NAME="63"><U>How can I get a value from a TI-Basic matrix element?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I have a matrix on the top of the expression stack which is produced as a
result of calculation, and I don't know how do I put a matrix element located
at [i,j] into result (values of 'i' and 'j' may vary)? I have read infos about
<A HREF="estack.html">estack.h</A>, but I couldn't find the answer...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
There is a lot of methods. I suggest the following one:</P>
<PRE>ESI ptr;
int result;
int i = 1;                             // <I>Just an example</I>
int j = 2;
push_parse_text ("[[11,12][21,22]]");  // <I>An example matrix</I>
ptr = locate_element (i,j);
result = GetIntArg (ptr);              // <I>(assumed that elements are ints)</I>
</PRE>
<P>where <CODE>'locate_element'</CODE> is an user-written function, which may be
implemented as follows:</P>
<PRE>ESI locate_element (short m, short n)
{
  short i;
  ESI ptr = top_estack-1;
  for (i = 0; i &lt; m-1; i++) ptr = next_expression_index (ptr);
  ptr--;
  for (i = 0; i &lt; n-1; i++) ptr = next_expression_index (ptr);
  return ptr;
}
</PRE>
<P>You can use it as-is, but it will be much better if you can
understand how it works.
</TD></TR></TABLE></P>

<H3><A NAME="64"><U>How can I make my C function return itself?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Suppose I'm writing an ASM function <CODE>'foo(n)'</CODE> which accepts an
argument (a string, for example). I want to make <CODE>'foo(n)'</CODE>
return <CODE>'foo(n)'</CODE> (the call itself) when <CODE>'n'</CODE> is of type
"VAR" (i.e. if nothing has been assigned to <CODE>'n'</CODE> yet)...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
This is quite easy, if you know in advance the name of the program.
Suppose, that your program name is "example". Here is the demo (called
"Function Returning Itself") which will return <CODE>'example(n)'</CODE> if
you type <CODE>'example(n)'</CODE> if
<CODE>'n'</CODE> is a variable, and which will return the string "blabla"
(for example) if the argument is something else:</P>
<PRE>// A function returning itself

#define USE_TI89              // Compile for TI-89
#define USE_TI92PLUS          // Compile for TI-92 Plus
#define USE_V200              // Compile for V200

#define RETURN_VALUE          // Return pushed expression
#define MIN_AMS 101           // Compile for AMS 1.01 or higher
#define SAVE_SCREEN           // Save/Restore LCD Contents

#include &lt;tigcclib.h&gt;         // Include All Header Files

// Main Function
void _main(void)
{
  ESI argptr = top_estack;
  if (GetArgType (argptr) &lt;= VAR_Q_TAG)  // it means that arg is a variable
                                         // see Tags to see why...
    push_expr_quantum (SYMSTR (&quot;example&quot;), USERFUNC_TAG);
  else
    {
      while (ESTACK (top_estack) != END_TAG)
        top_estack = next_expression_index (top_estack);
      top_estack--;
      push_string (SYMSTR (&quot;blabla&quot;));
    }
}
</PRE>
<P>Note that this solution is not ideal: if you rename the program name to something else,
the function will still return <CODE>'example(n)'</CODE>. It
<I>is</I> possible to determine the real name of the program in the run time, but this
is very awkward.
</TD></TR></TABLE></P>

<HR>
<H3><A NAME="18"><U>How can I display a number variable on the screen (like an int)?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
How can I convert an integer or a float to a string?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
It's easy. Use
<A HREF="stdio.html#sprintf">sprintf</A>. For example:</P>
<PRE>char string1[50];
char string2[50];
short int var1;
float var2;
...
sprintf (string1, "%d", var1);
sprintf (string2, "%f", var2);
</PRE>
<P>That's why there is no need for functions like <B>itoa</B> and <B>ftoa</B>
in opposite to <A HREF="stdlib.html#atoi">atoi</A> and <A HREF="timath.html#atof">atof</A>.
</TD></TR></TABLE></P>

<H3><A NAME="101"><U>Do you plan on implementing 7-level grayscale?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Do you plan to implement 7-level grayscale mode?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
So far no, because nobody yet implemented 7-level grayscale which works stable on both HW1
and HW2 calculators. I don't want to implement features which works only on HW1 calculators.
</TD></TR></TABLE></P>

<H3><A NAME="14"><U>How can I use sprites?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Do you know how I can use sprites with GCC4TI ?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Another common question. The answer depends on the size of the sprite.
If your sprite is not wider than 32 pixels (which is likely),
then you can now use the <A HREF="sprites.html">sprites.h</A>
header file. This header file defines fast functions which work with sprites
(including masked sprites). The only limitation is that the sprite must not be
wider than 32 pixels (the height is not limited).
<BR><BR>
What to do if you want sprites wider than 32 pixels, and don't want to use
kernel-based programming? The answer depends on what the usage of this sprite will be. If you don't
need fast action, the built-in function <A HREF="graph.html#BitmapPut">BitmapPut</A>
may be good enough. If you need a very fast sprite routine, you may be better
off using the ExtGraph library by the
<A HREF="http://tict.ticalc.org/">TI-Chess Team</A>.
</TD></TR></TABLE></P>

<H3><A NAME="15"><U>I don't understand how to define sprites!</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I can't understand how sprites are defined; I looked in many program sources, and every
sprite definition looks for me as an array of random hex numbers!?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Well, suppose that you want to make a sprite which is a
filled circle. Make a grid on the paper, and make a sprite shape by filling
grid squares. Then, replace each filled square with 1 and each blank square
with 0. In above example, it may look like:
<BR><BR>
00111000<BR>
01111100<BR>
11111110<BR>
11111110<BR>
01111100<BR>
00111000
<BR><BR>
Then, produce rows as a set of binary numbers, and convert them
to hex. For example:
<BR><BR>
00111000 binary = 38 hex<BR>
01111100 binary = 7C hex
<BR><BR>
etc. These hex numbers describe the sprite, i.e. the sprite
definition should be</P>
<PRE>unsigned char sprite [] = {0x38, 0x7C, ...};
</PRE>
<P>assuming that <A HREF="sprites.html#Sprite8">Sprite8</A> will be used. That's all...
<BR><BR>
<B>Note:</B> GCC4TI also supports binary numbers (<CODE>0b...</CODE>).
</TD></TR></TABLE></P>

<H3><A NAME="17"><U>How do you use sprite functions from sprites.h with grayscale?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I would like to know if it is possible to use the sprite functions
in <A HREF="sprites.html">sprites.h</A> with grayscale. I have tried
using the <A HREF="sprites.html#Sprite16">Sprite16</A> function with
grayscale, and none of the sprites I intended to be in grayscale appeared.
I tried to use <A HREF="graph.html#DrawIcon">DrawIcon</A> and the grayscale
worked just fine. But <A HREF="graph.html#DrawIcon">DrawIcon</A> is too
slow... Can <A HREF="sprites.html#Sprite16">Sprite16</A> and
<A HREF="sprites.html#Sprite32">Sprite32</A> handle grayscale sprites.
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Very common question in a recent time. See, you probably tried to use
<A HREF="gray.html#GraySetAMSPlane">GraySetAMSPlane</A>.
<A HREF="sprites.html#Sprite16">Sprite16</A> have a parameter for drawing
plane, so it is not sensitive to <A HREF="gray.html#GraySetAMSPlane">GraySetAMSPlane</A>:
you need to give the plane as an explicite parameter. In fact, you need to
have two different sprite planes and to draw a sprite twice, passing two
different planes as a parameter. For example,</P>
<PRE>static unsigned short light_definition [] = {...};
static unsigned short dark_definition [] = {...};
...
Sprite16 (x, y, height, light_definition, GrayGetPlane (LIGHT_PLANE), A_XOR);
Sprite16 (x, y, height, dark_definition, GrayGetPlane (DARK_PLANE), A_XOR);
</PRE>
<P>In other words, sprite routines <I>can</I> handle grayscale
sprites, but not natively, meaning you have to take your grayscale
sprite, split it into two layers, and draw each one separately on its
own plane - the routine does not handle these by itself. As suggested
by Scott Noveck, it is possible to make a function of your own to
handle this. Assume that your grayscale sprites follow the "standard"
format seen in the most of ASM games, with the dark plane data followed
immediately by the light plane data. This routine will call
<A HREF="sprites.html#Sprite16">Sprite16</A> twice - once for each plane:</P>
<PRE>void GraySprite16 (short x, short y, short h, unsigned short *spr, short mode)
{
  Sprite16 (x, y, h, *spr, GetPlane (LIGHT_PLANE), mode);
  Sprite16 (x, y, h, *spr + h, GetPlane (DARK_PLANE), mode);
}
</PRE>
<P>Don't be afraid about calling <A HREF="gray.html#GrayGetPlane">GrayGetPlane</A> each
time: it is not a waste of time. Its implementation is smart: when the input
is a constant, it will simply evaluate to a memory address that
contains the pointer; when it is variable, it expands to a simple macro.
</TD></TR></TABLE></P>

<H3><A NAME="22"><U>How does BitmapGet work?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Can you give me info on how <A HREF="graph.html#BitmapGet">BitmapGet</A> works.
I've tried  everything that I know and I still get protected memory errors. The
manual just doesn`t give anything solid to base a few lines of code on.
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
You probably didn't allocate enough space to store a bitmap.
The simplest way to do so is given in this example (called "Bitmap Test"):</P>
<PRE>// Retrieve and store a bitmap

#define USE_TI89              // Compile for TI-89
#define USE_TI92PLUS          // Compile for TI-92 Plus
#define USE_V200              // Compile for V200

#define OPTIMIZE_ROM_CALLS    // Use ROM Call Optimization

#define MIN_AMS 100           // Compile for AMS 1.00 or higher

#include &lt;tigcclib.h&gt;         // Include All Header Files

// Main Function
void _main(void)
{
  SCR_RECT full_screen = {{0, 0, LCD_WIDTH - 1, LCD_HEIGHT - 1}};
  char buffer [BITMAP_HDR_SIZE + LCD_WIDTH*LCD_HEIGHT/8]; // or 2004 for a TI-89 and 3844 for a TI-92+/V200 if you like it more
  BitmapGet (&amp;full_screen, buffer);          // store screen in buffer
  clrscr ();
  printf (&quot;Press any key to\nrestore screen...&quot;);
  ngetchx ();
  BitmapPut (0, 0, buffer, &amp;full_screen, A_REPLACE);
  ngetchx ();
}
</PRE>
<P>Note that this is just an example: for saving/restoring the whole screen,
the functions <A HREF="graph.html#LCD_save">LCD_save</A> and
<A HREF="graph.html#LCD_restore">LCD_restore</A> are much more efficient!
Moreover, <I>buffer</I> will probably be allocated using
<A HREF="alloc.html#malloc">malloc</A> in a more realictic example.
</TD></TR></TABLE></P>

<H3><A NAME="39"><U>How can I create a virtual screen?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
How I can change the port for the screen memory to draw to it, and then copy it
back to the regular address?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Do this:</P>
<PRE>void *virtual = malloc (LCD_SIZE);  // <I>Allocate the buffer</I>
...
if (!virtual) ... // <I>do some error handling - not enough memory!</I>
PortSet (virtual, 239, 127); // <I>redirect drawing routines to buffer</I>
</PRE>
<P>or, even simpler, virtual screen may be simply in any local variable which is
enough long:</P>
<PRE>char virtual[3840];
...
PortSet (virtual, 239, 127);
</PRE>
<P>Note that, in this case, virtual memory will be in fact somewhere on the stack.
There is nothing bad in this, but keep in mind that the total amount of the
stack is 16K, so don't put TOO MANY data (like big arrays etc.) on the stack
(i.e. in local variables). If you really need to handle a lot of data, use
<A HREF="alloc.html#malloc">malloc</A> instead.
<BR><BR>
After this, do any drawing you want - it will be redirected to the virtual
screen. To copy this to the regular screen (i.e. to display it) do this:</P>
<PRE>memcpy (LCD_MEM, virtual, LCD_SIZE);
</PRE>
<P>or even simpler (this is the same):</P>
<PRE>LCD_restore (buffer);
</PRE>
<P>And, don't forget to do <A HREF="graph.html#PortRestore">PortRestore</A> before end of the program, else TIOS will
be fooled after returning to TI-Basic!
</TD></TR></TABLE></P>

<H3><A NAME="40"><U>How can I set up a SCR_RECT structure?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
How I can setup properly a <A HREF="graph.html#SCR_RECT">SCR_RECT</A> structure?
For example, the <A HREF="graph.html#FillTriangle">FillTriangle</A>
function requires the parameter of <A HREF="graph.html#SCR_RECT">SCR_RECT</A> type.
How to put coordinates into it, so that I can change the clipping area for the screen?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
If all coordinates of clip area are known in advance (for example 5, 5, 90, 70),
do this:</P>
<PRE>FillTriangle (10, 10, 10, 50, 50, 50, &amp;(SCR_RECT){{5, 5, 90, 70}}, A_NORMAL);
</PRE>
<P>or, using "standard" C (i.e. without <A HREF="gnuexts.html">GNU extensions</A>):
</P>
<PRE>SCR_RECT area = {{5, 5, 90, 70}};  // <I>somewhere in the declaration part</I>
...
FillTriangle (10, 10, 10, 50, 50, 50, &amp;area, A_NORMAL);
</PRE>
<P>Note that double braces are necessary because <A HREF="graph.html#SCR_RECT">SCR_RECT</A>
is an union.
<BR><BR>
If coordinates are not known in advance, for examples if they are in
integer variables a, b, c and d, you can do this:</P>
<PRE>SCR_RECT area;
...
area.xy.x0 = a;
area.xy.y0 = b;
area.xy.x1 = c;
area.xy.y1 = d;
FillTriangle (10, 10, 10, 50, 50, 50, &amp;area, A_NORMAL);
</PRE>
<P>or, much simpler, using <A HREF="gnuexts.html">GNU C extensions</A>:</P>
<PRE>FillTriangle (10, 10, 10, 50, 50, 50, &amp;(SCR_RECT){{a, b, c, d}}, A_NORMAL);
</PRE>
<P></TD></TR></TABLE></P>

<H3><A NAME="42"><U>How can I make a WINDOW structure?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I would like to make my own window but I don't understand the lot of fields in
the <A HREF="wingraph.html#WINDOW">WINDOW</A> structure, like <CODE>'TaskID'</CODE>
and others!
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
You do not need to fill up the <A HREF="wingraph.html#WINDOW">WINDOW</A>
structure manually: function <A HREF="wingraph.html#WinOpen">WinOpen</A>
will fill everything automatically. See the next question for examples of usage.
</TD></TR></TABLE></P>

<H3><A NAME="43"><U>How do I use functions from the wingraph.h file?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I need some examples of how to use the functions in the <A HREF="wingraph.html">wingraph.h</A> header file.
Especially, I am confused with static and/or dynamic data allocation.
I tried to use <A HREF="alloc.html">alloc.h</A> to create necessary structures, but something was wrong...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
I will give five very similar examples how to do the same thing. From the first and
fifth example you will see that you need not to use <A HREF="alloc.html">alloc.h</A> at all, and in the
second, third and fourth example, you will see what you need to do if you want
to use dynamic allocation (i.e. <A HREF="alloc.html">alloc.h</A>) anyway. Maybe this is not so obvious
from my documnetation, but flags in <A HREF="wingraph.html#WinOpen">WinOpen</A> must be ORed, so they must be
"separated" by "|", not by commas.
<BR><BR>
Example 1: Using <A HREF="wingraph.html">wingraph.h</A> without dynamic allocation (called "Window 1"):</P>
<PRE>#define USE_TI89              // Compile for TI-89
#define USE_TI92PLUS          // Compile for TI-92 Plus
#define USE_V200              // Compile for V200

#define OPTIMIZE_ROM_CALLS    // Use ROM Call Optimization
#define MIN_AMS 100           // Compile for AMS 1.00 or higher
#define SAVE_SCREEN           // Save/Restore LCD Contents

#include &lt;tigcclib.h&gt;         // Include All Header Files

// Main Function
void _main(void)
{
  WINDOW wind;
  WIN_RECT winr = {20, 20, 80, 50};
  WinOpen (&amp;wind, &amp;winr, WF_SAVE_SCR | WF_TTY);
  WinActivate (&amp;wind);
  WinFont (&amp;wind, F_6x8);
  WinStr (&amp;wind, &quot;hello everyone&quot;);
  ngetchx ();
  WinClose (&amp;wind);
}
</PRE>
<P>Example 2: Window is allocated dynamically (called "Window 2"):</P>
<PRE>#define USE_TI89              // Compile for TI-89
#define USE_TI92PLUS          // Compile for TI-92 Plus
#define USE_V200              // Compile for V200

#define OPTIMIZE_ROM_CALLS    // Use ROM Call Optimization
#define MIN_AMS 100           // Compile for AMS 1.00 or higher
#define SAVE_SCREEN           // Save/Restore LCD Contents

#include &lt;tigcclib.h&gt;         // Include All Header Files

// Main Function
void _main(void)
{
  WINDOW *wind = HeapAllocPtr (sizeof (WINDOW));
  WIN_RECT winr = {20, 20, 80, 50};
  WinOpen (wind, &amp;winr, WF_SAVE_SCR | WF_TTY);
  WinActivate (wind);
  WinFont (wind, F_6x8);
  WinStr (wind, &quot;hello everyone&quot;);
  ngetchx ();
  WinClose (wind);
  HeapFreePtr(wind);
}
</PRE>
<P>Note that synonyms for <A HREF="alloc.html#HeapAllocPtr">HeapAllocPtr</A> and
<A HREF="alloc.html#HeapFreePtr">HeapFreePtr</A> are
<A HREF="alloc.html#malloc">malloc</A> and <A HREF="alloc.html#free">free</A> (like in ANSI C).
<BR><BR>
Example 3: Both "window" and "rect" are allocated dynamically (called "Window 3"):</P>
<PRE>#define USE_TI89              // Compile for TI-89
#define USE_TI92PLUS          // Compile for TI-92 Plus
#define USE_V200              // Compile for V200

#define OPTIMIZE_ROM_CALLS    // Use ROM Call Optimization
#define MIN_AMS 100           // Compile for AMS 1.00 or higher
#define SAVE_SCREEN           // Save/Restore LCD Contents

#include &lt;tigcclib.h&gt;         // Include All Header Files

// Main Function
void _main(void)
{
  WINDOW *wind = HeapAllocPtr (sizeof (WINDOW));
  WIN_RECT *winr = HeapAllocPtr (sizeof (WIN_RECT));
  winr-&gt;x0 = 20; winr-&gt;y0 = 20;
  winr-&gt;x1 = 80; winr-&gt;y1 = 50;
  WinOpen (wind, winr, WF_SAVE_SCR | WF_TTY);
  WinActivate (wind);
  WinFont (wind, F_6x8);
  WinStr (wind, &quot;hello everyone&quot;);
  ngetchx ();
  WinClose (wind);
  HeapFreePtr (wind);
  HeapFreePtr (winr);
}
</PRE>
<P>Example 4: How to use <A HREF="wingraph.html#MakeWinRect">MakeWinRect</A> to avoid "winr" (called "Window 4"):</P>
<PRE>#define USE_TI89              // Compile for TI-89
#define USE_TI92PLUS          // Compile for TI-92 Plus
#define USE_V200              // Compile for V200

#define OPTIMIZE_ROM_CALLS    // Use ROM Call Optimization
#define MIN_AMS 100           // Compile for AMS 1.00 or higher
#define SAVE_SCREEN           // Save/Restore LCD Contents

#include &lt;tigcclib.h&gt;         // Include All Header Files

// Main Function
void _main(void)
{
  WINDOW *wind = HeapAllocPtr (sizeof (WINDOW));
  WinOpen (wind, MakeWinRect (20, 20, 80, 50), WF_SAVE_SCR | WF_TTY);
  WinActivate (wind);
  WinFont (wind, F_6x8);
  WinStr (wind, &quot;hello everyone&quot;);
  ngetchx ();
  WinClose (wind);
  HeapFreePtr (wind);
}
</PRE>
<P>Example 5: This is what I do in my programs (called "Window 5"):</P>
<PRE>#define USE_TI89              // Compile for TI-89
#define USE_TI92PLUS          // Compile for TI-92 Plus
#define USE_V200              // Compile for V200

#define OPTIMIZE_ROM_CALLS    // Use ROM Call Optimization
#define MIN_AMS 100           // Compile for AMS 100 or higher
#define SAVE_SCREEN           // Save/Restore LCD Contents

#include &lt;tigcclib.h&gt;         // Include All Header Files

// Main Function
void _main(void)
{
  WINDOW wind;
  WinOpen (&amp;wind, &amp;(WIN_RECT) {20, 20, 80, 50}, WF_SAVE_SCR | WF_TTY);
  WinActivate (&amp;wind);
  WinFont(&amp;wind, F_6x8);
  WinStr (&amp;wind, &quot;hello everyone&quot;);
  ngetchx ();
  WinClose (&amp;wind);
}
</PRE>
<P>Don't forget to close a window before exiting. If you forget to do so, the
TI may crash later, when window manager tries to refresh a still active window
which ceased to exist due to end of the program!
<BR><BR>
In general, I prefer static allocation instead of dynamic. It is good if you
know in advance how many open windows you have in the program (this is often a
case on TI). Dynamic allocation is the only method if you don't know in advance
how many open windows you need (then, you can keep them in linked list). I
don't think that there is a lot of use for this on the TI. :-)
</TD></TR></TABLE></P>

<H3><A NAME="44"><U>How do you use DrawIcon?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I don't understand how to use <A HREF="graph.html#DrawIcon">DrawIcon</A>.
Do I need to use <A HREF="graph.html#pICON">pICON</A>?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
If you want to draw an icon at 50,50 for example, do:</P>
<PRE>ICON i = {1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16};
...
DrawIcon (50, 50, &amp;i, A_NORMAL);
</PRE>
<P>Of course, change 1, 2, 3... to the real definition of the icon.
<BR><BR>
<A HREF="graph.html#pICON">pICON</A> is necessary only for using with icons which are dynamically allocated
(forget it if you are not familiar with dynamic structures in C), like in:</P>
<PRE>pICON p = malloc (32);
...
// <I>Here is a code which fill up the icon structure</I>
...
DrawIcon (50, 50, p, A_REPLACE);
</PRE>
<P>Look operator "&amp;" in first example, it is omitted in second example. In fact,
"&amp;" converts a variable of <A HREF="graph.html#ICON">ICON</A> type to
<A HREF="graph.html#pICON">pICON</A> type (in general, it converts any
type to corresponding pointer type).
</TD></TR></TABLE></P>

<H3><A NAME="45"><U>I need a really fast line-drawing routine...</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I want to make a program which draw a lot of lines (for example which does some
kind of 3D graphic). But, it seems that <A HREF="graph.html#DrawLine">DrawLine</A>
function is not too fast for my purposes. What I can do?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Yes, TIOS drawing routines are not championes in speed. Note that really fast
line drawing function may be written only in ASM. But don't underestimate the power
of C: even in pure C it is possible to make better (read: faster) line drawing
routine than TIOS routine. As a programming exercise, I started with one trivial
line drawing routine, and tried to optimize it. What I got is the routine which is
in general 3-4 times faster than TIOS <A HREF="graph.html#DrawLine">DrawLine</A> routine.
In some special cases, TIOS routine may be faster (for example, TIOS routine handles
special cases when the line is horizontal or vertical), but in general case (slope
lines) my routine is much better. Maybe (and probably) it may be speed-optimized yet; this is
a challenge for you. Here is the routine (example "Draw Line"):</P>
<PRE>// Example of a fast line-drawing routine

#define USE_TI89              // Compile for TI-89
#define USE_TI92PLUS          // Compile for TI-92 Plus
#define USE_V200              // Compile for V200

#define MIN_AMS 100           // Compile for AMS 1.00 or higher
#define SAVE_SCREEN           // Save/Restore LCD Contents

#include &lt;tigcclib.h&gt;         // Include All Header Files

// Draws a line from (x1,y2) to (x2,y2).
void DrawLineFast(short x1, short y1, short x2, short y2)
{
  short x = x1, y = y1;
  short dx = abs (x2 - x1), dy = abs (y2 - y1);
  short ystep = (y1 &lt; y2) ? 1 : -1, pystep = 30 * ystep;
  short mov = dx ? 0 : -1;
  unsigned char *ptr = (char*)LCD_MEM + 30 * y + (x &gt;&gt; 3);
  short mask = 1 &lt;&lt; (~x &amp; 7);
  if (x1 &lt; x2)
    while (x != x2 || y != y2)
      {
        *ptr |= mask;
        if (mov &lt; 0) y += ystep, ptr += pystep, mov += dx;
        else
          {
            mov -= dy;
            if (++x &amp; 7) mask &gt;&gt;= 1;
            else ptr++, mask = 0x80;
          }
      }
  else
    while (x != x2 || y != y2)
      {
        *ptr |= mask;
        if (mov &lt; 0) y += ystep, ptr += pystep, mov += dx;
        else
          {
            mov -= dy;
            if (x-- &amp; 7) mask &lt;&lt;= 1;
            else ptr--, mask = 1;
          }
      }
}

// Main Function
void _main(void)
{
  DrawLineFast (10, 10, 60, 70);
  ngetchx ();
}
</PRE>
<P>If you need a line erasing or line inverting routine, replace
<CODE>'*ptr&nbsp;|=&nbsp;mask'</CODE> with
<CODE>'*ptr&nbsp;&amp;=&nbsp;~mask'</CODE> or <CODE>'*ptr&nbsp;^=&nbsp;mask'</CODE>
respectively.
</TD></TR></TABLE></P>

<H3><A NAME="67"><U>I can't reset printf to start at the top of the screen!</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
When I'm using <A HREF="stdio.html#printf">printf</A> function, I'm not abble to reset the
scrolling: after using this function, and after clearing the screen,
the text is still displayed at the bottom of the screen, even if the
calculator was turned off between two use of the program...
How can I reset the scrolling?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
As I know, I warned in the documentation that <A HREF="graph.html#ClrScr">ClrScr</A> and
<A HREF="stdio.html#clrscr">clrscr</A> are not the same:
the second one resets the print position too, so you need to use it.
Anyway, you can always use <A HREF="graph.html#MoveTo">MoveTo</A> to reset print position to
(0,0) which effective resets the scrolling.
</TD></TR></TABLE></P>

<H3><A NAME="85"><U>How can you disable the 2nd and alpha indicators at the bottom of the screen?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
How do you make that the status line is not visible on the screen so that the
status indicators do not mess up your graphics?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
The most general method (I use this) is: disable auto-int 1 using
<A HREF="system.html#OSSetSR">OSSetSR</A> function (status line indicators are updated
from this interrupt). Note that in this case you need to read the keyboard using the
<A HREF="kbd.html#_rowread">_rowread</A> function, because
<A HREF="kbd.html#ngetchx">ngetchx</A> etc. are based on auto-int 1. I used this method
in my program cblaster (you can pick it from ticalc). Anyway, if you use
<A HREF="kbd.html#_rowread">_rowread</A>, you should also disable auto-int 5 as well.
</TD></TR></TABLE></P>

<H3><A NAME="86"><U>When I disable interrupts, grayscale doesn't work!</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I'm writing a game in C, but I encountered the following problem: when I
disable interrupts, the grayscale doesn't work...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Of course, because grayscale is based on interrupts. I.e. you must not disable them
in grayscale programs. So, what to do? You probably want to disable auto-int 1 to avoid screwing up
the status line. Instead of DISABLING auto-int 1, you may REDIRECT it
to nothing. New header file <A HREF="intr.html">intr.h</A> provides very elegant methods
for doing this. It is enough to do this:</P>
<PRE>INT_HANDLER save_int_1;
...
save_int_1 = GetIntVec (AUTO_INT_1);
SetIntVec (AUTO_INT_1, DUMMY_HANDLER);   // <I>redirect auto-int 1 to "nothing"</I>
// <I>enable grayscale</I>
// <I>do your code</I>
// <I>disable grayscale</I>
SetIntVec (AUTO_INT_1, save_int_1);
</PRE>
<P></TD></TR></TABLE></P>

<H3><A NAME="87"><U>While I was fiddling with interrupt handlers...</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I'm just fiddling around with interrupt handlers and don't understand why the
following code won't work:</P>
<PRE>void myInterruptHandler(void)
{
  asm ("movem.l %d0-%d7/%a0-%a6,-(%sp)");
  // <I>do something here...</I>
  asm ("movem.l (%sp)+,%d0-%d7/%a0-%a6; rte");
}
&nbsp;
</PRE>
<P></TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
There are two reasons for this. First, the sequence "do something here"
surely uses some local variables. The compiler will put them in
registers during the optimization, and it will generate code for
saving them on the stack at the beginning of the procedure, <B>before</B> the
execution of any statements in the function body. So, before executing</P>
<PRE>asm("movem.l %d0-%d7/%a0-%a6,-(%sp)");
</PRE>
<P>something will be pushed on the stack. Read this as "open
brace '{' is not only the marker, it also generates an entry
procedure code". So, when "rte" is encountered, the return
address on the stack is trashed. Second, even if the
procedure does not use any local vars, the entry code for the
procedure is usually</P>
<PRE>link #something,%a6
</PRE>
<P>and the stack is again not suitable for executing "rte".
Before release 2.2 of TIGCCLIB, the only universal and correct method for defining
interrupt handlers was is to define a pure assembly auxilary procedure as follows:</P>
<PRE>void InterruptHandler(void);  // <I>Just a prototype</I>
asm ("myInterruptHandler:
      move.w #0x2700,%sr
      movem.l %d0-%d7/%a0-%a6,-(%sp)
      jbsr MainHandler
      movem.l (%sp)+,%d0-%d7/%a0-%a6
      rte");

void MainHandler(void)
{
  // <I>Put everything you want here...</I>
}
</PRE>
<P>To make life easier, starting from release 2.2, I introduced a new language extension called
<A HREF="intr.html#DEFINE_INT_HANDLER">DEFINE_INT_HANDLER</A> in the <A HREF="intr.html">intr.h</A>
header file. Now, it is enough to write</P>
<PRE>DEFINE_INT_HANDLER (myInterruptHandler)
{
  // <I>Put everything you want here...</I>
}
</PRE>
<P></TD></TR></TABLE></P>

<HR>
<H3><A NAME="13"><U>How can I use a kernel-based libraries in C?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Is there any method to use a kernel-based library with GCC4TI (such as ZipLib) and
how to call a routine that uses something other than the stack in the routine
for arguments passing?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Good and common question. When an assembly routine uses register passing, the
solution is not so obvious. I will give a concrete example. Look at ZipLib,
function compress. Quoting from the PreOS documentation:</P>
<PRE>; compress ()
; Function: compress data
; Input: A0   = Pointer to uncompressed data
;        A1   = Pointer to where the compressed data
;               should be stored
;        D0.W = Length of datas which will be compressed
; ziplib::compress equ ziplib@0004
</PRE>
<P>So, how to interface this with GCC4TI? There is a lot of solutions. One
solution is to use an interface function which accepts parameters via stack
then to use embeded assembler to call library function:</P>
<PRE>void compress (void *src, void *dest, unsigned short len)
{
  asm ("move.l (%a6,8),%a0
        move.l (%a6,12),%a1
        move.w (%a6,16),%d0
        jsr ziplib__0004");
}
</PRE>
<P>This works, but maybe it is awkward to know where the parameters are stored on
the stack. GNU C has some extensions for interfacing with assembler, so the
following solution is more elegant:</P>
<PRE>void compress (void *src, void *dest, unsigned short len)
{
  asm ("move.l %0,%%a0" :: "g"(src));
  asm ("move.l %0,%%a1" :: "g"(dest));
  asm ("move.w %0,%%d0" :: "g"(len));
  asm ("jsr ziplib__0004");
}
</PRE>
<P>If you don't understand this (which is probably the case if you are not
familiar with <A HREF="gnuexts.html">GNU C extensions</A>), accept this as as-is template.
<BR><BR>
Both solutions have two bad points: first, usage of stack is awkward if you
want very fast calling. Second, this interface function will always be
inserted in the code (even if not called in the program), so it is not suitable
for making universal header files. As GNU C allows interfacing arbitrary C
expressions with assembler, and allows building smart safe macros using
so-called "statement expressions", the following solution avoids both the stack
and "embedding" problem:</P>
<PRE>#define compress(src, dest, len) \
  ({ asm ("move.l %0,%%a0" :: "g"(src)); \
     asm ("move.l %0,%%a1" :: "g"(dest)); \
     asm ("move.w %0,%%d0" :: "g"(len)); \
     asm ("jsr ziplib__0004"); })
</PRE>
<P>In any case, you can call function (or macro) "compress" using, for example,</P>
<PRE>compress (LCD_MEM, buffer, LCD_SIZE);
</PRE>
<P>etc.
<BR><BR>
The third solution has one drawback: the impossibility of compile-time checking of
parameters type. This can be solved using the following construction (don't be
afraid by introducing extra variables; the compiler will remove them during the
optimization, and it will produce the same code as in previous example, but with
type-checking):</P>
<PRE>#define compress(src, dest, len) \
  ({ void *__src = (src), *__dest = (dest); \
     unsigned long __len = (len); \
     asm ("move.l %0,%%a0" :: "g"(__src)); \
     asm ("move.l %0,%%a1" :: "g"(__dest)); \
     asm ("move.w %0,%%d0" :: "g"(__len)); \
     asm ("jsr ziplib__0004"); })
</PRE>
<P>There is also fifth, nearly "ideal" solution,
using GNU cast constructors which constructs a function during the compilation
(look how functions in <A HREF="stdio.html">stdio.h</A> are implemented, etc.).
But, I will not present this here, because you will not understand anything
if you are not familiar with cast constructors.
<BR><BR>
<B>Note:</B> TIGCC v0.94 and later (which GCC4TI is) support explicit register specification.
</TD></TR></TABLE></P>

<H3><A NAME="88"><U>How can I communicate between ASM and C code?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Maybe I am quite stupid, but I cannot catch anything about communicating information
between the C code and the assembly code... I'm not really familiar with mixing
high-level languages with assembly language; all I really know is that the
<CODE>asm</CODE> keyword allows one to include assembly instructions in C
source code. But how would would you write an assembly function that C code could
utilize?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
This is explained in detail, see section about <A HREF="gnuexts.html#SEC94">Extended Asm</A>.
</TD></TR></TABLE></P>

<HR>
<H3><A NAME="35"><U>How do you use strcat properly?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Whenever I used <A HREF="string.html#strcat">strcat</A> in my program, it
crashes!?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
See, you probably want to ask what is wrong in the following code:</P>
<PRE>printf (strcat ("Hello ", "World!"));
</PRE>
<P><A HREF="string.html#strcat">strcat</A> appends the second argument to the
first argument and returns the augmented first argument, but it does not
allocate any extra space for doing this task. So, if you do</P>
<PRE>strcat ("Hello ", "World!");
</PRE>
<P>string <CODE>"World!"</CODE> will be copied over bytes which follows immidiately
after bytes <CODE>"Hello "</CODE> in the memory (whatever is there), which will
nearly surely cause a crash (because there is probably a part of code or other
data there). So, <A HREF="string.html#strcat">strcat</A> may be used only when
the first argument is enough long buffer, like in:</P>
<PRE>char buffer[50];
strcpy (buffer, "Hello ");
strcat (buffer, "World!");
</PRE>
<P>In other words, C language does not support dynamic string manipulations which is
present in some other languages like Basic, Turbo Pascal, etc.
</TD></TR></TABLE></P>

<H3><A NAME="19"><U>How can I write an efficient number to string routine?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I am just curious how I can write my own and efficient IntToStr routine...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Process the number starting from the end (i.e. from the least
significant digit instead from the most significant digit), like in the
following example, which is probably the most optimal code:</P>
<PRE>char *IntToStr (unsigned long an_integer)
{
  static char result [] = "          \0";    // <I>10 spaces and \0</I>
  char *ptr = result + 10;
  while (an_integer)
    {
      *ptr-- = an_integer % 10 + '0';
      an_integer/=10;
    }
  return ptr;
}
</PRE>
<P>Note that <CODE>'static'</CODE> before char in the first line is essential: without it, the
variable <CODE>'result'</CODE> will be allocated of the stack, so it will not live
too long after this function returns. Returning any pointers which points to
structures allocated on the stack is extremely dangerous (it is not only dangerous; it is
almost completely nonsense, except if you performs some really nasty and bizzare hacks).
The another solution (but less elegant) is to make <CODE>'result'</CODE> global (i.e. to
define it out of the function).
</TD></TR></TABLE></P>

<H3><A NAME="105"><U>Why can't I use a backslash (e.g. &quot;main\var&quot;) in my strings?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
When I type <CODE>"main\var"</CODE>, the compiler gives me an error. Help!
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
This is a common problem among beginning programmers.
The backslash (<CODE>\</CODE>) is used as an escape character in the C language.
Because of this, you need to modify your string to read like this: <CODE>"main\\var"</CODE>.
Now, compiler will interpret the <CODE>\\</CODE> as a single backslash, which is what you want.
<BR><BR>
If you want to lean more about escape sequences, look at the information on
<A HREF="opers.html#quotes">strings</A>.
</TD></TR></TABLE></P>

<HR>
<H3><A NAME="23"><U>If my program throws an error, I can't start it again!</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
If my program stops execution by throwing an error, I cannot execute it again without
retransmitting it from the computer or another calculator. Namely, when I try to execute
it again, the calculator reports "Invalid program reference". Why, and what I can do
to prevent such behaviour?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
See <A HREF="htretval.html#reterr">Returning Errors</A>.
</TD></TR></TABLE></P>

<H3><A NAME="59"><U>Can dialogs have popup menus with submenus?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
The popup menu given in the example for <A HREF="menus.html">menus.h</A> seems to work fine on its own,
but not when used in a dialog: if you select anything after "Option 2" the text
in the selector is the wrong one. Can't dialog popups handle sub-menus?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
I am afraid that popups in dialogs can't have sub-menus. I think so because I never
see on TI-89 any system dialog which has such popups. Yes, it sucks, but this is not
my guilt...
</TD></TR></TABLE></P>

<H3><A NAME="77"><U>Why does calling the previous event handler in a user event handler result in a crash?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
What is wrong in calling the previous installed event handler in a new one?
Whenever I tried to do so, my only result is a crash...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Very probably you do</P>
<PRE>OldHandler = EV_captureEvents (NewHandler);
</PRE>
<P>then you call <CODE>OldHandler</CODE> from <CODE>NewHandler</CODE>. There would be nothing
wrong in doing so, but function <A HREF="events.html#EV_captureEvents">EV_captureEvents</A>
returns <A HREF="alloc.html#NULL">NULL</A> when there is no any user handlers previously
installed, which is very common case. So, you can call <CODE>OldHandler</CODE> only if
it is not null. In other words, it is illegal to call an event handler when it is not
actually installed. From the other side, function <A HREF="events.html#EV_defaultHandler">EV_defaultHandler</A>
calls the TIOS handler which is used for default dispatching of some common events. It works independently of
which handler is currently installed and whether it is installed at all. This is a function
which you probably need to call in your event handler to process all unprocessed events.
</TD></TR></TABLE></P>

<H3><A NAME="78"><U>How can I use functions in textedit.h to edit a text variable?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I don't understand how I can use functions from <A HREF="textedit.html">textedit.h</A>
header file to edit a text variable. When I tried to open a blank editor
everything seems OK, but when I tried to edit an existing text variable, I
got a crash...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
I must admit that the problem is not so easy. The problem
is, in fact, caused by severe error in my documentation in releases of
TIGCCLIB prior to 2.2 (it is corrected now). Namely, I was wrong when I told
that a handle passed as a parameter to <A HREF="textedit.html#TE_open">TE_open</A>
function may be a handle of a text variable. In fact, text variables have another
extra data at the begining (one word for the length, and one word for
the cursor position). But, the editor expects a raw data. I inspected what TIOS
does exactly during opening a text variable. Then I concluded: there is no any
other solutions than striping out extra data (this is a little play with
<A HREF="mem.html#memmove">memmove</A>). Of course, after the editing is finished, it is
necessary to reconstruct again the proper structure of the text variable (this is
possible using some informations presented in <A HREF="textedit.html#TEXT_EDIT">TEXT_EDIT</A>
structure after the editing is finished).
<BR><BR>
After this theoretical elaboration, I will be much more concrete. Here is a complete
code example (called "Text Editor") which edits the text variable named "mytext". Due to simplicity, it
is assumed that this variable really exists and that it is not archived:</P>
<PRE>// A simple text editor example

#define USE_TI89              // Compile for TI-89
#define USE_TI92PLUS          // Compile for TI-92 Plus
#define USE_V200              // Compile for V200

#define OPTIMIZE_ROM_CALLS    // Use ROM Call Optimization
#define MIN_AMS 100           // Compile for AMS 1.00 or higher
#define SAVE_SCREEN           // Save/Restore LCD Contents

#include &lt;tigcclib.h&gt;         // Include All Header Files

TEXT_EDIT te;

// Typical event handler for text editing
CALLBACK void EventHandler(EVENT *ev)
{
  if (ev-&gt;Type == CM_KEYPRESS &amp;&amp; ev-&gt;extra.Key.Code == KEY_ESC)
    ER_throw (1);
  if (!TE_handleEvent (&amp;te, ev))
    EV_defaultHandler (ev);
}

// Main Function
void _main(void)
{
  char *base_addr;
  SYM_ENTRY *sym = SymFindPtr (SYMSTR (&quot;mytext&quot;), 0);

  if (!sym) return;  // Exit if file not found...

  // First, you need to remove the garbage data at the begining of
  // the text variable, because the text editor expects raw data:

  base_addr = HeapDeref (sym-&gt;handle);
  memmove (base_addr, base_addr + 4, peek_w(base_addr));

  // Now, do the editing. This is straightforward...

  WinClr (DeskTop);
  TE_open (&amp;te, DeskTop, MakeWinRect (0, 16, 159, 92), sym-&gt;handle, 1, 0, 7);
  CU_start ();
  EV_captureEvents (EventHandler);
  TRY
     EV_eventLoop ();
  ONERR
     EV_captureEvents (NULL);
  ENDTRY

  // Finally, you must transform raw editor data into the proper
  // format of the text variable. This is not so straightforward:

  base_addr = HeapDeref (HeapRealloc (sym-&gt;handle, te.CurSize + 10));
  memmove (base_addr + 4, base_addr, te.CurSize);
  poke_w (base_addr, te.CurSize + 4);
  poke_w (base_addr + 2, te.CursorOffset);
  poke (base_addr + te.CurSize + 4, 0);
  poke (base_addr + te.CurSize + 5, TEXT_TAG);
}
</PRE>
<P>It is important to understand how this program works if you plan to do any
serious application of text editing functions.
</TD></TR></TABLE></P>

<H3><A NAME="79"><U>I tried to create a new window for the text editor, but it didn't work...</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
When I tried to create my own window to be used as a parent window for the text editor
(instead of the <A HREF="wingraph.html#DeskTop">DeskTop</A> window), and when I passed
the address of my window to <A HREF="textedit.html#TE_open">TE_open</A>, the editor went
blank (it did not display the file contents on the screen, although the editing seemed to
work). What is wrong?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
I was also very surprised when I noticed this. After some investigations,
I concluded that the window passed to <A HREF="textedit.html#TE_open">TE_open</A> must not be
"dirty" (i.e. it must not have <A HREF="wingraph.html#WinFlags">WF_DIRTY</A> flag set), but
windows created by <A HREF="wingraph.html#WinOpen">WinOpen</A> are "dirty" by default. So, you
need to clear "dirty" flag manually before calling <A HREF="textedit.html#TE_open">TE_open</A>.
This is straightforward. For example,</P>
<PRE>WIN_RECT myRect = {0, 16, 159, 92};
WINDOW myWin;
TEXT_EDIT te;
...
WinOpen (&amp;myWin, &amp;myRect, WF_NOBORDER);
myWin.Flags &amp;= ~WF_DIRTY;
TE_open (&amp;te, &amp;myWin, &amp;myRect, ...);
</PRE>
<P>Anyway, there is no strong reasons to use any windows other than <A HREF="wingraph.html#DeskTop">DeskTop</A>
as a parent window, except if you want to use the whole screen for the editing area (the desktop
window is clipped in the toolbar area). But, note that using whole screen for editing is not so
good idea. The editor expects that the menu is on the top. So, if you press F1 etc. while doing
"full-screen" editing, your screen will be trashed, because the editor will open the menu, and
it will expect that the toolbar is at the top, etc. etc. Try to see. The solution? Disable all
keys like F1, etc. in the event handler (e.g. do not pass them to <A HREF="textedit.html#TE_handleEvent">TE_handleEvent</A>)
if you really want to do full screen editing...
</TD></TR></TABLE></P>

<H3><A NAME="80"><U>Can you change the font in the text editor?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Is it possible to use any other font except 6x8 font in the text editor?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Principally, you can change font using <A HREF="wingraph.html#WinFont">WinFont</A>
before calling <A HREF="textedit.html#TE_open">TE_open</A>. For example, you can do</P>
<PRE>WinFont (DeskTop, F_8x10);</PRE>
<P>However, the editor will work fine with both 6x8 and 8x10 fonts, but not with
4x6 font (try and see), because it is proportional, so the editor will
be fooled (editors usually expects fixed-size fonts). This is a pity.
</TD></TR></TABLE></P>

<H3><A NAME="58"><U>Why isn't it possible to create menus with more than one level of submenu with PopupAddText, and how can I do it anyway?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
The documentation about <A HREF="menus.html">menus.h</A> says (cite): "Although TIOS menu system allows
menus with more than one level of submenus, it is not possible to create such
menus using this command (<A HREF="menus.html#PopupAddText">PopupAddText</A>)". What happens then?
And how it is possible to make menus with more levels of submenus?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
The answer of the first part of the question is: just nothing. Options which are added on
deeper levels are just ignored. When I dissassembled this routine, I found that this is really
not implemented! About the second part of the question: this is answered in the documentation
about <A HREF="menus.html">menus.h</A> header file.
</TD></TR></TABLE></P>

<H3><A NAME="60"><U>How can I use VTI to pick bytes from menu structures like you describe?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
The documentation about <A HREF="menus.html#MenuPopup">MenuPopup</A>
says that it is possible to make popup menus by picking up bytes
with the VTI debugger to save the memory, but I don't know how to
do this. Could you tell me how to do this, please?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Not so easy to explain if you are not an experienced user. Basically, after you
define a menu using <A HREF="menus.html#PopupNew">PopupNew</A>,
<A HREF="menus.html">PopupAddText</A> etc., you need to display its address
instead of executing it. E.g. instead of doing</P>
<PRE>PopupDo (handle, ...)
</PRE>
<P>you need to do something like:</P>
<PRE>printf_xy (0, 50, "Address=%lp", HeapDeref (handle));
ngetchx();
</PRE>
<P>Then, while waiting for a keypress, open the VTI debugger and go to the
displayed address. Take a pencil and write a sequence of bytes starting
from this address. Tenth and eleventh byte in this sequence will tell to you
how many bytes you need to pick. After this, put these bytes in the array,
and pass such array as an argument to the <A HREF="menus.html#MenuPopup">MenuPopup</A>
function. As an exercise, try this on an example given in the documentation.
</TD></TR></TABLE></P>

<HR>
<H3><A NAME="51"><U>How can I get a list of all the variables/folders on the calculator?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Does any function exists to find out how many folders are on the calculator
and what files are in them? In other words, is there a way to get an array of
all the folders on the calculator or an array of all the files in a folder?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
This was very frequent question, but you can find the answer by reading carefully info about
<A HREF="vat.html#SymFindFirst">SymFindFirst</A> and
<A HREF="vat.html#SymFindNext">SymFindNext</A>. And, look the example about returning values to
TI-Basic given on the main page of this documentation. Mail me if still not clear...
</TD></TR></TABLE></P>

<H3><A NAME="52"><U>How can I determine the type and size of a variable?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
How I can determine the size of a symbol (i.e. TI-Basic variable) and the TIOS type
of the variable?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Assume that you found a VAT symbol entry for a symbol (say symbol named "foo")
which may be done for example using <A HREF="vat.html#SymFindPtr">SymFindPtr</A>:</P>
<PRE>SYM_ENTRY *sym;
...
sym = SymFindPtr (SYMSTR ("foo"), 0);
</PRE>
<P>Then, do the following to find the size and type:</P>
<PRE>unsigned short size;
ESQ type;
...
size = ((MULTI_EXPR*) HeapDeref (sym-&gt;handle))->Size + 2;
type = *(HToESI (sym-&gt;handle));
</PRE>
<P>After this, the variables <CODE>'size'</CODE> and <CODE>'type'</CODE> will contain exactly
what do you want.
</TD></TR></TABLE></P>

<H3><A NAME="53"><U>How can I copy a variable from one folder to another?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I don't understand how to copy a symbol (TI-Basic variable) from one folder to
another. As I can see, <A HREF="vat.html#SymCpy">SymCpy</A> doesn't copy the
entire symbol, just the name!?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Moving symbols is quite easy (using <A HREF="vat.html#SymMove">SymMove</A>), but copying
is not so straightforward. Principally, you need to create a new one, and to
copy the content of the original one into a new one. Fortunately, it is
possible to use <A HREF="bascmd.html#cmd_copyvar">cmd_copyvar</A> from
<A HREF="bascmd.html">bascmd.h</A>.
As it is TI-Basic call, it is highly recommended to execute it
under a <A HREF="error.html#TRY">TRY</A>...<A HREF="error.html#ONERR">ONERR</A>...<A HREF="error.html#ENDTRY">ENDTRY</A>
block.
</TD></TR></TABLE></P>

<H3><A NAME="54"><U>How can I create a List or Matrix variable to keep highscores or similar information?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Is there a way to use TI89's Lists or Matrix, so I will be able to keep
information like high score or something else...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Yes, more info about this can be found in this release of GCC4TILIB
documentation (note that a matrix is a "list of lists"). However, using lists or
matrices is somewhat complicated. It is much easier to keep information in
a user-defined format. See the <A HREF="#55">next question</A>.
<BR><BR>
A <A HREF="stdio.html">stdio.h</A> header file is implemented, which
supports ANSI C compatible file handling, so creating files is quite simplified.
If you want to bypass <A HREF="stdio.html">stdio.h</A>
and use low-level TIOS routines (such an approach leads to smaller programs), see
<A HREF="vat.html#SymAdd">SymAdd</A>.
</TD></TR></TABLE></P>

<H3><A NAME="55"><U>Can I create a variable with a custom type (like HSC for highscores)?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Is it possible to create a file which will have a custom type (i.e. which does not appear
in VAR-LINK as a stanard type like STR, PIC, PRGM etc.). For example, I want to create a
highscore file which will appear in VAR-LINK as HSC type...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Christian Walther pointed to me that this is possible. Moreover, this is easy. All you need
to do is to create a file of "other" type (i.e. which terminates with <A HREF="estack.html#OTH_TAG">OTH_TAG</A>).
TIOS then expects that a real type name is stored just below <A HREF="estack.html#OTH_TAG">OTH_TAG</A>
as a zero-started zero-terminated string of maximum 4 chars. Look the following code fragment
as an example:</P>
<PRE>FILE *fp = fopen ("example", "wb");
// <I>store anything you want in the file here</I>
fputc (0, fp);
fputs ("HSC", fp);
fputc (0, fp);
fputc (OTH_TAG, fp);
fclose (fp);
</PRE>
<P>After this, you will have a file named "example" with type "HSC": you will see it in the
VAR-LINK dialog.
</TD></TR></TABLE></P>

<H3><A NAME="56"><U>I want to create a variable without using functions from stdio.h.</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I want to avoid standard ANSI C functions for file handling like
<A HREF="stdio.html#fopen">fopen</A> etc. and to use low-level functions from
<A HREF="vat.html">vat.h</A> (to make my program shorter), but I am not very sure
what I need exactly to do to create a new file, and how I can manipulate with it.
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Basically, to create a file you need to do the following:</P>
<OL>
<LI><P>Create a new VAT symbol using <A HREF="vat.html#SymAdd">SymAdd</A>;</P></LI>
<LI><P>Allocate a space for the variable using <A HREF="alloc.html#HeapAlloc">HeapAlloc</A>;</P></LI>
<LI><P>Dereference the symbol to get a pointer to the VAT entry, then
store the handle returned by <A HREF="alloc.html#HeapAlloc">HeapAlloc</A> to it;</P></LI>
<LI><P>Put the actual file length in first two bytes of allocated space.</P></LI>
</OL>
<P>To be more concrete, I will show here a simple demo program (called "Create Variable")
which creates a string file (I use this internally), but it is easy to adapt to
any file type:</P>
<PRE>// Create a variable using functions from vat.h

#define USE_TI89              // Compile for TI-89
#define USE_TI92PLUS          // Compile for TI-92 Plus
#define USE_V200              // Compile for V200

#define OPTIMIZE_ROM_CALLS    // Use ROM Call Optimization
#define MIN_AMS 100           // Compile for AMS 1.00 or higher
#define SAVE_SCREEN           // Save/Restore LCD Contents

#include &lt;tigcclib.h&gt;         // Include All Header Files

HANDLE CreateFile (const char *FileName)
// Returns a handle, H_NULL in case of error
{
  HANDLE h;
  SYM_ENTRY *sym_entry;
  char str[30], *sptr = str;
  *sptr = 0; while ((*++sptr = *FileName++));
  if (!(h = HeapAlloc (HeapMax ()))) return H_NULL;
  if (!(sym_entry = DerefSym (SymAdd (sptr))))
    {
      HeapFree (h);
      return H_NULL;
    }
  *(long*) HeapDeref (sym_entry-&gt;handle = h) = 0x00010000;
  return h;
}

void AppendCharToFile (HANDLE h, unsigned char c)
{
  char *base = HeapDeref(h);
  unsigned short len = *(unsigned short*)base;
  if (len &gt; HeapSize(h) - 10) return;
  *(unsigned short*)base = len + 1;
  base[len+2] = c;
}

void AppendBlockToFile (HANDLE h, void *addr, unsigned short len)
{
  unsigned short i;
  for (i = len; i; i--) AppendCharToFile (h, *((char*)addr)++);
}

void CloseFile (HANDLE h)
{
  AppendCharToFile (h,0); AppendCharToFile (h,0x2D);
  HeapUnlock (h);
  HeapRealloc (h, *(unsigned short*)HeapDeref(h) + 3);
}

void _main(void)
{
  static char s[] = &quot;Hello world!&quot;;
  HANDLE h;
  h = CreateFile (&quot;example&quot;);
  AppendBlockToFile (h, s, 12);
  CloseFile (h);
}
</PRE>
<P>Note that the used method is not the best: it initially
allocates as much space as avaliable, then reallocates the space to
the necessary size on closing, but it is worth to look at it. Note
also that the <CODE>CreateFile</CODE> function may be even simpler if you want to use it
like <CODE>CreateFile(SYMSTR("example"))</CODE> instead of
<CODE>CreateFile("example")</CODE>, i.e. if you avoid the use of ANSI strings.
</TD></TR></TABLE></P>

<H3><A NAME="84"><U>When I use functions from vat.h, the calculator crashes!</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
When I tried to use <A HREF="vat.html#EM_moveSymToExtMem">EM_moveSymToExtMem</A> to archive
a file, the calculator crashed!
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
You probably wrote something like</P>
<PRE>EM_moveSymToExtMem ("example", HS_NULL);
</PRE>
<P>Instead, you need to write</P>
<PRE>EM_moveSymToExtMem (SYMSTR ("example"), HS_NULL);
</PRE>
<P>This routine except <A HREF="estack.html#SYM_STR">SYM_STR</A> type strings, not ordinary C strings. See
<A HREF="vat.html#SYMSTR">SYMSTR</A> from the <A HREF="vat.html">vat.h</A> header file for more info.
</TD></TR></TABLE></P>

<HR>
<H3><A NAME="25"><U>I have trouble allocating memory, my program crashes on the second run.</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I have problems with allocating memory.
When I run my program the first time, it works just as expected,
but the second (or sometimes the third) time I run it, it hangs.
Typical memory allocation problem. But I just can't understand what the
problem is.
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
The problem is very probably not related to the dynamic memory allocation, but
to the usage of static variables. At the moment, all static vars need to
be initialized, even to nothing. I.e, you need to use</P>
<PRE>static int a = 0, b = 0;
static char *ptr = NULL;
</PRE>
<P>instead of</P>
<PRE>static int a, b;
static char *ptr;
</PRE>
<P>I expect that this will solve your problems.
</TD></TR></TABLE></P>

<H3><A NAME="26"><U>I can't understand C matrices!</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I can't understand matrices in C (not TI-Basic matrices, but matrices which are
the part of the C language)!
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Basically, to declare a matrix, you need to use:</P>
<PRE>type <I>name</I>[<I>dimension1</I>][<I>dimension2</I>];</PRE>
<P>for example:</P>
<PRE>int a[5][5];
</PRE>
<P>And, to access element of the matrix, you need to use:</P>
<PRE><I>name</I>[<I>index1</I>][<I>index2</I>];</PRE>
<P>for example:</P>
<PRE>a[2][3] = 10;</PRE>
<P>or</P>
<PRE>x = a[1][2];
</PRE>
<P>But note that indices are not from 1 to dimension, but from
0 to dimension-1. So, in the above example, both
indices are in range 0 to 4, not 1 to 5. For example to fill all matrix by zeroes,
you can use this code:</P>
<PRE>int a[5][5], i, j;     // <I>A 5x5 array of ints, and two single ints</I><BR>
for(i = 0; i &lt; 5; i++)
  for (j = 0; j &lt; 5; j++)
    a[i][j] = 0;
</PRE>
<P>although the experienced C programmer will simply use</P>
<PRE>memset (a, 0, 5 * 5 * sizeof(int));</PRE>
<P>to make it faster.
</TD></TR></TABLE></P>

<H3><A NAME="28"><U>How do I store variables so they retain their values, like for highscores?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
How do you store preferences, high scores, and suchlike so that they do not go away
when you exit the program?  I have absolutely no clue how to do this.
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
The simplest method is: if you stored preferences in an
array, declare this array as "static". For example,</P>
<PRE>static int high_scores[10] = {};</PRE>
<P>In this case, such array will be kept in the program file itself (instead on the stack),
so it will not go away after you exit the program. This method has only one drawback:
preferences will not be kept if the program is archived.
<BR><BR>
Be aware of the initializer: static variables <B>must</B> be initialized in
the "nostub" mode. An empty initializer in this example is equivalent to the</P>
<PRE>static int high_scores[10] = {0, 0, 0, 0, 0, 0, 0, 0, 0, 0};
</PRE>
<P>Don't be confused which such initialization. It seems that the array elements will
be set back to 0 any time when you run the program. But, this is not true.
The initialization of automatic
and static variables is quite different. Automatic (local) variables are initialized
during the run-time, so the initialization will be executed whenever it is
encountered in the program. Static (and global) variables are initialized during
the compile-time, so the initial values will simply be embeded in the executable
file itself. If you change them, they will retain changed in the file.
</TD></TR></TABLE></P>

<H3><A NAME="29"><U>Global variables retain value?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
If I understand correctly, if I have the following global variable in my program</P>
<PRE>int a = 10;
</PRE>
<P>and if I change its value somewhere in the program to 20 (for example), its initial
value will be 20 (not 10) when I run the program next time???
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Exactly! Note that this is true only for global and static variables.
To force reinitializing, you must put explicitely something
like</P>
<PRE>a = 10;
</PRE>
<P>at the begining of the main program!
<BR><BR>
Note, however, that if the program is archived,
the initial values will be restored each time you run the program, because archived
programs are reloaded from the archive memory to the RAM on each start, similarly
to the programs are reloaded from disks on "standard" computers (PC, etc.) each
time when you start them. The same is true for compressed programs (for obvious
reasons) and if you use a data variable and have GCC4TI create a copy every time
it is used.
</TD></TR></TABLE></P>

<P>See also: <A HREF="#28">How do I store variables so they retain their values</A></P>
<H3><A NAME="30"><U>How can you control where data is stored in memory and access it?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
How can you control where a program data is stored in the calculator's memory, and
then how to access the data? By looking at your programs (cblaster etc.), you simply
use <A HREF="mem.html#memcpy">memcpy</A> to write to the array, which seems so easy!
Is the array kept in memory because it's declared as static?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Yes. Every static and global data (i.e. data which are declared out of functions)
are kept in the <CODE>.89z</CODE>/<CODE>.9xz</CODE> file itself (more precise, in the area of the memory allocated to
<CODE>.89z</CODE>/<CODE>.9xz</CODE> file), so they will survive after the end of the program.  Local data
are stored on the stack (so they will be deleted after the end of the function in which
they are declared).
</TD></TR></TABLE></P>

<H3><A NAME="31"><U>What is so horrible about global variables?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
You quote very often in the documentation that we need to avoid global variables
as much as possible. What is so wrong with them?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Of course, globals are sometimes very necessary, but they are also easy to overuse. The
good programming practice is to keep the scope of each identifier as small as possible.
But, in addition to conventional programming theory, there are some extra reasons
against globals which are related particularly to programming on TI calculators.
First, every global variable is translated to the absolute addressing mode.
As this mode is non-relocatable, the compiler adds a 4-byte long entry into the
relocation table for each apperance of the global variable. If global variable "a" is
mentioned say 100 times in the program, this is extra 400 bytes. When I ported some
programs from PC to TI, I suceeded to reduce program space from 20K to 16K just by
eliminating globals. And 4K of space is quite worth on TI... Second, globals are kept
in the <CODE>.89z</CODE> (or <CODE>.9xz</CODE>) file itself. Sometimes it is good
(to keep permanent data which will survive after the program exits etc.), but very
often it is a wasting of file space (as the file length is limited). Read questions
given further in this document to see how to reduce a file size if you have a
strong reasons for using global arrays. To learn: avoid extensive usage of globals
as much as possible!
</TD></TR></TABLE></P>

<H3><A NAME="32"><U>How can you store a number such as 0x4c00 in a pointer?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
According to what I have read, you cannot store an immediate value (or any
non-pointer variable) to a pointer variable. You can only copy pointers of
the same type and such. Now, the books may say this, but, is there a way
to do this somehow? I want something like <CODE>'address=0x001fca;'</CODE> where
address is a pointer to a char. Is it necessary to use the assembler for this?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
No. C is enough low-level language that nearly everything which can be done in
ASM can be done in pure C too (of course, pure ASM code is usually faster).
In your concrete example, using of typecasting is quite enough:</P>
<PRE>address = (char*)0x001fca;
</PRE>
<P>This is really a classic usage of the typecast operator. It is extremely powerful
in C language, so it may be used to convert nearly <I>everything</I> to <I>anything</I>.
This sometimes may be really terrible. For example, in early TIGCCLIB implementation, I
used strange typecasting to convert an array to a function. And, nearly all library
functions are implemented using a typecast operator which constructs an indirect function call.
For example, when you use something innocent like</P>
<PRE>DrawStr (0, 0, "Hello", A_NORMAL);
</PRE>
<P>the <A HREF="cpp.html">preprocessor</A> expands it into a really terrible typecast.
See <A HREF="default.html#_rom_call">_rom_call</A> for more info.
</TD></TR></TABLE></P>

<H3><A NAME="33"><U>Is it possible to add one or two bytes to a longword pointer?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Is it possible to add two bytes or even one byte to a longword pointer? I am using
a longword pointer to write longwords to the screen, and I need to add 30 bytes to
it to get to the next line. However, I can only add multiples of four bytes to it...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
It is possible using typecasting:</P>
<PRE>ptr = (long*)((char*)ptr + 30);
</PRE>
<P>Don't be afraid, the compiler will generate just addition: everything
other is just to satisfy type checking conventions. Or alternatively, you can
use even simpler form:</P>
<PRE>(char*)ptr += 30;
</PRE>
<P>Although such form is not requested to work in ANSI C standard, the most of compilers
(including GCC4TI) will accept this.
</TD></TR></TABLE></P>

<H3><A NAME="34"><U>Why can't you assign values to dereferenced void pointers?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Why doesn't this work?</P>
<PRE>void *screen_ptr = LCD_MEM;
*screen_ptr = 0xFF;
</PRE>
<P>When I do this, I get the error "Invalid use of void expression" at the
second line. Can't you assign a value to a dereferenced void pointer?
If not, what good is a void pointer?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
You can not dereference a void pointer, without an explicite typecasting,
because the compiler can't know the size of an object pointed to by it.
You can do an explicite typecast:</P>
<PRE>*(char*)screen = 0xFF;
</PRE>
<P>Or better, if you need to dereference it often, then declare</P>
<PRE>unsigned char *screen = LCD_MEM;
</PRE>
<P>i.e. avoid void pointers for this purpose (continue reading to see why
such assignment is legal, i.e. assigning <A HREF="graph.html#LCD_MEM">LCD_MEM</A>
which is a void pointer to a char pointer).
<BR><BR>
Void pointers are used mainly as arguments of functions which
represents memory addresses, no matter what is the object located at
that addresses. Then, any pointer type (including arrays, which are
in fact pointers to the first element of the array) may be passed
to such function without warnings and without needness for explicite
typecasting. For example, <A HREF="mem.html#memcpy">memcpy</A> is such
function, and it is declared as:</P>
<PRE>void *memcpy (void *source, void *destination, unsigned long len);
</PRE>
<P>Ignore returned type for a moment. So, you can do</P>
<PRE>memcpy (LCD_MEM, buffer, 3840);
</PRE>
<P>but you also can do</P>
<PRE>memcpy (a, b, 10 * sizeof(long));
</PRE>
<P>assuming that you have declared</P>
<PRE>long a[10], b[10];
</PRE>
<P>somewhere in the program. Second, void pointers may be assigned to any
other pointer type and vice versa without and warnings and without
needness for explicite typecasting. They are usually returned as the
result of functions which don't make any assumptions what will be
purpose of returned pointer. For example, <A HREF="alloc.html#malloc">malloc</A>
is such function. It is declared as</P>
<PRE>void *malloc (unsigned long len);
</PRE>
<P>So, assuming that you have declared</P>
<PRE>char *a;
int *b;
long *c;
</PRE>
<P>you can do</P>
<PRE>a = malloc (100);
b = malloc (30 * sizeof(int));
c = malloc (50 * sizeof(long));
</PRE>
<P>without any problems.
</TD></TR></TABLE></P>

<H3><A NAME="36"><U>How can I have large global variables that don't take up space in my program file?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I would like to have a global screen buffers which need to be allocated
dynamically (to avoid wasting space in the program). The problem is that global
variables must be initialized. In your programs, you define the buffer in the
<CODE>_main</CODE> function, but then they are not available in the other functions. Is
there a way to make "global" non-initialized screen buffers?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Declare a pointer initialized to <A HREF="alloc.html#NULL">NULL</A>, then at the beginning
allocate the buffer with <A HREF="alloc.html#malloc">malloc</A>. For example, do this:</P>
<PRE>#include &lt;tigcclib.h&gt;
...
void *buff;  // <I>Buffer pointer</I>
...
void _main(void)
{
  ...
  buff = malloc (LCD_SIZE); // <I>Alloc buffer, make "buff" point to it</I>
  if (!buff) ...            // <I>Do some error handling (no memory)</I>
  LCD_save (buff);
  ...
  LCD_restore (buff);
  free (buff);
}
</PRE>
<P>Simple?
</TD></TR></TABLE></P>

<H3><A NAME="37"><U>How can I create a dynamic two-dimensional array?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Your hints about dynamic creation of arrays work fine for one-dimensional arrays. But
I need a global matrix. There is no problem if the matrix is small. But, if I simply put</P>
<PRE>int A[200][100] = {{}};
</PRE>
<P>I will increase the size of my program by about 40K (200*100*sizeof(int)). This is
really unacceptable. Obviously, I need to create a matrix dinamically. But I have no
any idea how to do this.
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Very good question. Solving this problem requires good knowledge about how arrays
and pointers are related. As this question usually has unadequate answers in various C
books, I will elaborate this topic (dynamic matrix) in more details.
<BR><BR>
One method, which is often recommended in books, is usage of array of pointers. Using this
method, you need to allocate each row of the matrix separately. For example,</P>
<PRE>int *A[200] = {};   // <I>An array of pointers</I>
...
for (i = 0; i &lt; 200; i++)
  A[i] = calloc (100, sizeof (int));
</PRE>
<P>assuming that all memory allocations were sucessfull. Note that the initializer <CODE>'{}'</CODE>
is not necessary if <CODE>'A'</CODE> is not global (but we will assume that it is). Of course,
you need to free allocated memory too at the end of the program. We will see a bit later why
this method is not recommended on TI calculators.
<BR><BR>
Using this method, you will have a global array which is 800 bytes long (200*4, where 4 is the
size of a pointer), which is much smaller than 40000 bytes. And, you need to know a number of
rows in advance. Some books suggests a method which does not use any extra space in the
executable file, and in which you need not to know any dimensions of the matrix in advance.
This method uses a double pointer (pointer to pointer):</P>
<PRE>int **A = NULL;
...
A = calloc (200, sizeof (*A));
for (i = 0; i &lt; 200; i++)
  A[i] = calloc (100, sizeof (int));
</PRE>
<P>The major drawback of both methods is complicated memory management. In a real program, you
need to be aware of a fact that each allocation may fail eventually, and you need to act
accordingly if this happens. And, these methods are too expensive for TI calculators. As
TIOS memory manager assigns a handle with each allocated block, reserving say 200 handles for
just one matrix is too expensive, if even possible, because the total number of free handles
is limited!
<BR><BR>
What to do? The best solution is so simple, but rarely documented in books. Instead of using
an array of pointers, use a pointer to an array! Seems strange, but only what you need to
do is:</P>
<PRE>int (*A)[100] = NULL;   // <I>A pointer to an array</I>
...
A = calloc (200, sizeof (*A));
</PRE>
<P>So, everything is done with just one <A HREF="alloc.html#calloc">calloc</A>! And, you can
free the memory just with one call to <A HREF="alloc.html#free">free</A>. Wonderful, isn't
it? Of course, whatever method you used, you can access to the elements of a matrix using
an usual syntax like <CODE>'A[i][j]'</CODE>. Note however that the last ("ideal") method
requires that you know the number of columns in advance. Try to understand how all three
methods work: it will help you understanding nontrivial pointers, arrays and relations
between them.
<BR><BR>
As many users ask me about creating dynamic matrix, I have made a complete demo program
for newbies (called "Dynamic Matrix") which creates and prints elements of dynamically created matrix, using the
third (the best in my opinion) method:</P>
<PRE>#define USE_TI89              // Compile for TI-89
#define USE_TI92PLUS          // Compile for TI-92 Plus
#define USE_V200              // Compile for V200

#define OPTIMIZE_ROM_CALLS    // Use ROM Call Optimization
#define MIN_AMS 100           // Compile for AMS 1.00 or higher
#define SAVE_SCREEN           // Save/Restore LCD Contents

#include &lt;tigcclib.h&gt;         // Include All Header Files

#define M 10
#define N 5

int (*A)[N] = NULL;

void _main (void)
{
  int i,j;
  A = calloc (M, sizeof (*A));     // &lt;I&gt;allocation&lt;/I&gt;
  for (i = 0; i &lt; M; i++)
    for (j = 0; j &lt; N; j++)
      A[i][j] = i*j;               // fill 'A' with the multiplication table
  clrscr ();
  for (i = 0; i &lt; M; i++)
    {
      for (j = 0; j &lt; N; j++)
        printf (&quot;%2d &quot;, A[i][j]);  // print out the matrix
      printf (&quot;\n&quot;);
    }
  free (A);                        // free the memory
  ngetchx();
}
</PRE>
<P>This method is really ideal if you know dimensions of the matrix in advance (which is usually
true). It may be easily extended to create dinamically arrays with more than two dimensions.
For example, to create dinamically array which behaves like</P>
<PRE>int A[M][N][P][Q];
</PRE>
<P>where <CODE>'N'</CODE>, <CODE>'P'</CODE> and <CODE>'Q'</CODE> are known in compile-time, you
can do:</P>
<PRE>int (*A)[N][P][Q];
...
A = calloc (M, sizeof (*A));
</PRE>
<P>However, if you don't know any dimension of the matrix in advance, the second method is preferable.
</TD></TR></TABLE></P>

<P>See also: <A HREF="#38">How can I create variable-size arrays?</A></P>
<H3><A NAME="38"><U>How can I create variable-size arrays?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I need variable-size arrays, i.e. arrays which size is not known in compile time...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
In general, making variable-size arrays in C is extremely easy for
one-dimensional arrays. Instead of</P>
<PRE>int a[n];  // <I>where n is not known in compile-time</I></PRE>
<P>you can write:</P>
<PRE>int *a;
...
a = calloc (n, sizeof (int));
</PRE>
<P>The same is not-so-easy for 2-dimensional arrays (see the previous question), and quite hard
(although possible) for n-dimensional arrays where n&gt;2. To do this, you need to have nasty
plays with pointers. It is even possible to make a function named <CODE>multi_dim</CODE> which
creates  multidimensional variable-sized arrays. I once created such routine for some
internal purposes (note that it is very tricky). Principally, its usage is like this:
if you want to simulate</P>
<PRE>int a[n1][n2][n3][n4];</PRE>
<P>where n1, n2, n3 and n4 are not known apriori, you need to do:</P>
<PRE>int ****a;  // <I>yes, quadruple pointer!!!</I>
...
a = multi_dim (4, sizeof (int), n1, n2, n3, n4);
</PRE>
<P>However, GCC4TI is GNU C, and it has some <A HREF="gnuexts.html">extensions</A> in addition to
"standard" C. For example, it allows variable-size arrays without any tricky
plays with pointers!!! (Note that this particular extension, together with a few others,
has been added to standard ISO C in 1999, so it is no longer non-standard.) Try this:</P>
<PRE>void _main(void)
{
  int m, n, p;
  m = random (5);
  n = random (5);
  p = random (5);
  {
    int a[m][n][p];
    // <I>do something with a</I>
  }
}
</PRE>
<P>and you will see that it works!
</TD></TR></TABLE></P>

<H3><A NAME="99"><U>Why do I get &quot;Value computed is not used&quot; when working with pointers?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I have a variable and a pointer to it, for example,</P>
<PRE>int a, ptr_to_a = &amp;a;
</PRE>
<P>When I tried to modify the variable "a" indirectly using the pointer, like in</P>
<PRE>*ptr_to_a++;
</PRE>
<P>the compiler reports to me "Value computed is not used". What is wrong here?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Note that although operators <CODE>'++'</CODE> and <CODE>'*'</CODE> have the same
precedence, <CODE>'++'</CODE> will be evaluated first, so this expression will be evaluated as</P>
<PRE>*(ptr_to_a++);
</PRE>
<P>i.e. it increases the pointer, then reads the value from it (which is not used for anything).
This is not what do you want, of course.
To perform what do you want (i.e. to increase the variable pointed to by the pointer), use
parentheses to change the order of evaluation, i.e. use</P>
<PRE>(*ptr_to_a)++;
</PRE>
<P>This will work as expected.
</TD></TR></TABLE></P>

<HR>
<H3><A NAME="68"><U>How can I get input from the keyboard?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
How I can get input from the keyboard?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
There is a lot of method how you can make such routine. This is quite easy if you are
a C programmer. The easiest but the worst method is to use <A HREF="stdio.html#gets">gets</A>
function from <A HREF="stdio.html">stdio.h</A> header file: <A HREF="stdio.html#gets">gets</A>
does not do any buffer length checking. In old releases of TIGCCLIB, it did not even allow
any editing facitilities (even backspace key would not work), but this is no longer the case.
A better idea is to use <A HREF="stdio.html#getsn">getsn</A> which does avoid buffer overflows.
But if you want to control what exactly is done by the input routine (for example, you may or may
not want to allow opening the CHAR menu), you'll have to make a
custom keyboard input routine. For example, I usually used the following routine, which is good enough
for many purposes (example "Input String"):</P>
<PRE>// Custom string input example

#define USE_TI89              // Compile for TI-89
#define USE_TI92PLUS          // Compile for TI-92 Plus
#define USE_V200              // Compile for V200

#define MIN_AMS 100           // Compile for AMS 1.00 or higher
#define SAVE_SCREEN           // Save/Restore LCD Contents

#include &lt;tigcclib.h&gt;         // Include All Header Files

// Custom String Input Function
void InputStr(char *buffer, unsigned short maxlen)
{
  SCR_STATE ss;
  short key;
  unsigned short i = 0;
  buffer[0] = 0;
  SaveScrState (&amp;ss);
  do
    {
      MoveTo (ss.CurX, ss.CurY);
      printf (&quot;%s_  &quot;, buffer);
        // Note that two spaces are required only if the F_4x6 font is used
      key = ngetchx ();
      if (key &gt;= ' ' &amp;&amp; key &lt;= '~' &amp;&amp; i &lt; maxlen)
        buffer[i++] = key;
      else if (key == KEY_BACKSPACE &amp;&amp; i)
        i--;
      buffer[i] = 0;
    } while (key != KEY_ENTER);
}

// Main Function
void _main(void)
{
  char s[20];
  clrscr ();
  InputStr (s, 20);
  printf (&quot;\n%s&quot;, s);
  ngetchx ();
}
</PRE>
<P>Especially, if very good editing facitilities are required, the best idea is to use routines
from the <A HREF="textedit.html">textedit.h</A> header file. These routines are extremely powerful
and fully customizable. Alternatively, you can also use routines from
<A HREF="dialogs.html">dialogs.h</A>, especially <A HREF="dialogs.html#DialogAddRequest">DialogAddRequest</A>.
</TD></TR></TABLE></P>

<P>See also: <A HREF="#69">Do you have the function that gets called when you do InputStr in TI-Basic?</A>, <A HREF="#70">How can I make a keyboard input function that allows you to bring up a menu?</A>, <A HREF="stdio.html#getsn">getsn</A></P>
<H3><A NAME="57"><U>I'm having trouble with the functions from link.h...</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I have problems with making a program for communication between two
calculators. For example, I can't seem to get data to consistantly transfer
over the calc to calc link using calls from <A HREF="link.html">link.h</A>. I wrote a simple program
that just reads key presses and sends them as bytes while checking for bytes
from the other calc. Strangely, it only gets about one byte for every 20 or so
keypresses...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Many people tells to me about various problems (smaller or greater) with <A HREF="link.html">link.h</A>.
See the answer about the question why the function <A HREF="kbd.html#ngetchx">ngetchx</A> is slow.
Maybe this will help you. I must tell that the linking is not so known topic for me... You must
ask some link guru if you want to know more about this problematic...
</TD></TR></TABLE></P>

<H3><A NAME="69"><U>Do you have the function that gets called when you do InputStr in TI-Basic?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Did you find the keyboard input function that gets called when you do an InputStr in
TI-Basic? I'm looking at <A HREF="kbd.html#GKeyIn">GKeyIn</A> as probably the main part of
whatever this function is, but it also includes the ability to bring up the CHAR dialog,
look up key equivalents, and lots of other nice stuff that I want to be able to use.
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
The TIOS function <A HREF="bascmd.html#cmd_inputstr">cmd_inputstr</A> just performs the InputStr command
from TI-Basic, but this function is rather limited, so in practice it is better to create a similar
function by yourself. I.e, it <I>is</I> possible to call it, but there is a lot of artefact in doing it.
</TD></TR></TABLE></P>

<P>See also: <A HREF="#68">How can I get input from the keyboard?</A>, <A HREF="#70">How can I make a keyboard input function that allows you to bring up a menu?</A>, <A HREF="stdio.html#getsn">getsn</A></P>
<H3><A NAME="70"><U>How can I make a keyboard input function that allows you to bring up the CHAR menu (or MATH, etc)?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I really need a routine like InputStr given above, but which is able to bring up the CHAR
dialog. However, I am not able to make such routine by myself...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
I received a lot of such questions. These questions are usually asked by newbie programmers,
but the answer is quite advanced. Although I don't like to present advanced routines
as-is without a lot of necessary explanations, I am requested to do so. Well, here is a
routine (example "Input String Advanced"):</P>
<PRE>// Custom string input example enabling the CHAR menu

#define USE_TI89              // Compile for TI-89
#define USE_TI92PLUS          // Compile for TI-92 Plus
#define USE_V200              // Compile for V200

#define MIN_AMS 100           // Compile for AMS 1.00 or higher
#define SAVE_SCREEN           // Save/Restore LCD Contents

#include &lt;tigcclib.h&gt;         // Include All Header Files

short captured;

CALLBACK void CaptureHandler(EVENT *ev)
{
  if (ev-&gt;Type == CM_STRING)
    captured = *(ev-&gt;extra.pasteText);
}

void InputStr(char *buffer, unsigned short maxlen)
{
  SCR_STATE ss;
  short key;
  unsigned short i = 0;
  buffer[0] = 0;
  SaveScrState (&amp;ss);
  do
    {
      MoveTo (ss.CurX, ss.CurY);
      printf (&quot;%s_  &quot;, buffer);
        // Note that two spaces are required only if the F_4x6 font is used
      do
        {
          key = ngetchx ();
          if (key == KEY_CHAR &amp;&amp; i &lt; maxlen)
            {
              EVENT ev;
              captured = 0;
              ev.Type = CM_KEYPRESS;
              ev.extra.Key.Code = key;
              EV_captureEvents (CaptureHandler);
              EV_defaultHandler (&amp;ev);
              EV_captureEvents (NULL);
            }
        } while (!captured);
      if (key == KEY_CHAR &amp;&amp; i &lt; maxlen)
        buffer[i++] = captured;
      if (key &gt;= ' ' &amp;&amp; key &lt;= '~' &amp;&amp; i &lt; maxlen) buffer[i++] = key;
      if (key == KEY_BACKSPACE &amp;&amp; i) i--;
      buffer[i] = 0;
    } while (key != KEY_ENTER);
}

// Main Function
void _main(void)
{
  char s[20];
  clrscr ();
  InputStr (s, 20);
  printf (&quot;\n%s&quot;, s);
  ngetchx ();
}
</PRE>
<P>It will be good if you can understand how it works (I recommend reading the documentation
for the <A HREF="events.html">events.h</A> header file).
</TD></TR></TABLE></P>

<P>See also: <A HREF="#68">How can I get input from the keyboard?</A>, <A HREF="#69">Do you have the function that gets called when you do InputStr in TI-Basic?</A>, <A HREF="stdio.html#getsn">getsn</A></P>
<H3><A NAME="71"><U>I'm having trouble with the OSGetStatKey function.</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I have problems with <A HREF="kbd.html#OSGetStatKeys">OSGetStatKeys</A> function.
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
See what I wrote about this in the documentation about <A HREF="kbd.html">kbd.h</A> header
file. I recommend usage of pseudoconstants from <A HREF="compat.html">compat.h</A> header
file instead.
</TD></TR></TABLE></P>

<H3><A NAME="72"><U>How can I read the keyboard faster than ngetchx, but easier than _rowread?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Is there any way for reading the keyboard faster than using <A HREF="kbd.html#ngetchx">ngetchx</A>
function, but without very low-level access using <A HREF="kbd.html#_rowread">_rowread</A>?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Yes, there is a LEGAL method to pick keystrokes directly from the keyboard queue. See
<A HREF="system.html#kbd_queue">kbd_queue</A> and other queuing functions from
<A HREF="system.html">system.h</A> header file.
</TD></TR></TABLE></P>

<H3><A NAME="73"><U>How can I get the key repetition feature to work using the keyboard queue?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Reading directly from the keyboard queue is a good idea, but the key repetition
feature does not work...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
On the first look, it seems that the key repetition feature really
does not work with <A HREF="system.html#OSdequeue">OSdequeue</A>. But, Marcos
Lopez informed me that this is not exactly true. Key repetition feature
works even with <A HREF="system.html#OSdequeue">OSdequeue</A>, but it will not
return the keycode itself for the repeated key, but sets an additional
bit in the keycode, so <I>value</I> becomes <I>value</I>&nbsp;+&nbsp;0x800.
If you use standard <A HREF="kbd.html#ngetchx">ngetchx</A> function, this
additional bit is masked out and your program will get the keycodes it expects.
But, it is very simple to mask out this bit manually and make the key repetition
feature working even with <A HREF="system.html#OSdequeue">OSdequeue</A>.
</TD></TR></TABLE></P>

<H3><A NAME="74"><U>Why are ngetchx and kbhit so slow?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Why functions <A HREF="kbd.html#ngetchx">ngetchx</A> and <A HREF="kbd.html#kbhit">kbhit</A>
are so slow?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
They also implements support for Silent Link feature (ability of automatic receiving programs
when the calculator is in Home Screen). That's why they may also interfere with the link
transfer!
</TD></TR></TABLE></P>

<H3><A NAME="75"><U>Is there a function like the idle_loop function?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
What is the true equivalent for the idle_loop function known from kernels?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
<CODE>GKeyIn&nbsp;(NULL,&nbsp;0)</CODE> is the most similar equivalent. <CODE>ngetchx&nbsp;()</CODE> is not so similar. Both functions
are defined in <A HREF="kbd.html">kbd.h</A>. Note that <A HREF="system.html#idle">idle</A>
defined in <A HREF="system.html">system.h</A> is NOT equivalent to idle_loop!
</TD></TR></TABLE></P>

<H3><A NAME="76"><U>How can I bring up the VAR-LINK dialog and get the name of the selected file?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
How do I bring up the VAR-LINK dialog from C code and then get the name of the
file that was selected?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
This is an advanced question. As the VAR-LINK dialog is an event-driven applet, you must
use event-driven functions defined in the <A HREF="events.html">events.h</A>
header file. Bringing up the VAR-LINK dialog is quite easy:</P>
<PRE>EVENT ev;
ev.Type = CM_KEYPRESS;
ev.extra.Key.Code = KEY_VARLNK;
EV_defaultHandler (&amp;ev);
</PRE>
<P>but getting the name of the file that was selected is a bit harder.
After executing the VAR-LINK dialog, the VAR-LINK applet will send the
name of the selected file to the current application via the <A HREF="events.html#EventIDs">CM_HSTRING</A>
message. This message may be captured by a user event handler. Here is the demonstration program
(called "Get File Name"):</P>
<PRE>// Open VAR-LINK dialog and let user select something

#define USE_TI89              // Compile for TI-89
#define USE_TI92PLUS          // Compile for TI-92 Plus
#define USE_V200              // Compile for V200

#define MIN_AMS 100           // Compile for AMS 1.00 or higher
#define SAVE_SCREEN           // Save/Restore LCD Contents

#include &lt;tigcclib.h&gt;         // Include All Header Files

char VarBuffer[20] = &quot;&quot;;

CALLBACK void VarLinkHandler (EVENT *ev)
{
  if (ev-&gt;Type == CM_HSTRING)
    {
      strncpy (VarBuffer, HeapDeref (ev-&gt;extra.hPasteText), 19);
      VarBuffer [19] = 0;
    }
  EV_defaultHandler (ev);
}

void VarLinkDialog (void)
{
  EVENT ev;
  EVENT_HANDLER OldHandler = EV_captureEvents (VarLinkHandler);
  memset (&amp;ev, sizeof (ev), 0);
  ev.Type = CM_KEYPRESS;
  ev.extra.Key.Code = KEY_VARLNK;
  EV_defaultHandler (&amp;ev);
  EV_captureEvents (OldHandler);
}

void _main(void)
{
  VarLinkDialog ();
  printf_xy (0, 50, &quot;You picked: %s&quot;, VarBuffer);
  ngetchx ();
}
</PRE>
<P>Read more about the <A HREF="events.html">events.h</A> header file:
incredible miracles may be produced using event-passing techniques!
</TD></TR></TABLE></P>

<H3><A NAME="98"><U>I'm having troubles while reading I/O ports!</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I have a lot of troubles while reading I/O ports. I need a loop which will wait until the
programable timer on the TI-89 reaches value 255. I know that I can read the value of the
programable timer counter using address 0x600017, so I made the following loop:</P>
<PRE>while (*(unsigned char *)0x600017 != 255);
</PRE>
<P>But, the calculator freezes. I tried to use <A HREF="peekpoke.html#peek">peek</A> macro, as in</P>
<PRE>while (peek (0x600017) != 255);
</PRE>
<P>No fortune again (I know that this is, in fact, the same as above). What is wrong?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
See, there is a problem when reading I/O ports in small loops. Look at the above loop for
example. The compiler will notice that the same value is read again and again in the loop. As
normal memory location can not be changed without explicitly writing to it, and there is nothing
in the loop which changes the address 0x600017, the optimizer will move memory reading out of the
loop to make the code more efficient. Such behavior is correct for ordinary memory locations.
But, in our case, it will cause an infinity loop. The compiler does not know anything about the
fact that 0x600017 is not an ordinary memory location but an I/O port, which may be
changed unpredictably (purely by the hardware, without any program control). To prevent
such behaviour, you should use the <CODE>volatile</CODE> keyword to make the address 'volatile',
i.e. to say to the compiler that this address may be changed unpredictably. So, the correct
code is</P>
<PRE>while (*(volatile unsigned char *)0x600017 != 255);
</PRE>
<P>The <A HREF="peekpoke.html#peekIO">peekIO</A> macro makes life easier. You can do</P>
<PRE>while (peekIO (0x600017) != 255);
</PRE>
<P>Basically, peekIO works exactly like <A HREF="peekpoke.html#peek">peek</A>, but prevents any unwanted optimizations
generated by the compiler. Always use <A HREF="peekpoke.html#peekIO">peekIO</A>
(or <A HREF="peekpoke.html#peekIO_w">peekIO_w</A>) for reading memory-mapped I/O ports, else you may have
troubles. The <A HREF="kbd.html#_rowread">_rowread</A> function in TIGCCLIB releases prior to 2.3 also
caused similar troubles, now this is corrected too.
<BR><BR>
<A HREF="peekpoke.html#peekIO">peekIO</A> may be used even for reading bytes into the memory, but <A HREF="peekpoke.html#peek">peek</A>
will generate better code when working with memory. However, use <A HREF="peekpoke.html#peekIO">peekIO</A> to read any memory
location which may change in a way which is unpredictable from the aspect of a normal program
flow (for example, a memory location which is changed in the body of the interrupt handler).
<BR><BR>
<B>Note:</B> For sending bytes to I/O ports, the macros <A HREF="peekpoke.html#pokeIO">pokeIO</A> and
<A HREF="peekpoke.html#pokeIO_w">pokeIO_w</A> are also introduced, which are more reliable for
this purpose than <A HREF="peekpoke.html#poke">poke</A> and <A HREF="peekpoke.html#poke_w">poke_w</A>.
</TD></TR></TABLE></P>

<HR>
<H3><A NAME="9"><U>Some of your examples don't compile!</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Some of your examples (like the example given in the documentation for <A HREF="rsa.html">rsa.h</A>
header file) don't compile!
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
No. They compile fine, if they are typed in absolutely correctly. But there is a hardly-visible problem
with the space character. The space between the macro name and the argument list is strictly
forbiden, else the macro will be treated as an argumentless macro. In other words, you must
not type</P>
<PRE>#define GetBignumArg (ap, bn) \
</PRE>
<P>instead of</P>
<PRE>#define GetBignumArg(ap, bn) \
</PRE>
<P>Hardly visible, isn't it?
</TD></TR></TABLE></P>

<H3><A NAME="12"><U>Why do you use -O2/-Os when -O3 performs better optimization?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I wonder why you put <B>'-Os'</B> as a default optimization option in the
compiler. <B>'-O3'</B> will perform better optimization...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Yes, but <B>'-O3'</B> produces bigger output than <B>'-Os'</B>, because it
performs loop unrolling and inlining of "short-enough" functions...
</TD></TR></TABLE></P>

<H3><A NAME="83"><U>I need to access the FLASH memory.</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I need access to the archive memory...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
This is implemented in this release. See <A HREF="flash.html">flash.h</A> header file.
</TD></TR></TABLE></P>

<H3><A NAME="24"><U>Some functions with no arguments (like 'off') don't work for me!</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
When I try to turn the calculator off using <A HREF="system.html#off">off</A> function
from <A HREF="system.html">system.h</A>, nothing happens. What is wrong?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Most probably, you wrote</P>
<PRE>off;</PRE>
<P>instead of</P>
<PRE>off ();
</PRE>
<P>This is very common misinterpretation of usage of argument-less function. You may ask why
the compiler did not display any errors? See, whenever you use the function name alone
(without the parenthesis), it is automatically converted to a pointer to the function
(this is very useful feature if used properly). So, <CODE>'off'</CODE> alone is interpreted
as a pointer, so you have an statement which consists of an effect-less expression, similarly
as if you wrote</P>
<PRE>2 + 3;
</PRE>
<P>This is not illegal in C, but it has no any effect (eventually, you will be warned by the
compiler that the statement has no effect, if you enable enough strong warning checking).
Such misinterpretations are very often with newbie users, so I will elaborate this in more
details. Suppose that you wrote</P>
<PRE>key = ngetchx;
</PRE>
<P>You probably want to call <A HREF="kbd.html#ngetchx">ngetchx</A> function to get a keypress,
but instead, you will assign the address of this function to the variable <CODE>'key'</CODE>,
because the function name without parenthesis is automatically converted to a pointer
(however, you will be warned by the compiler that it is very ugly to assign a pointer to
an integer variable without an explicite typecast). Instead, you need to write</P>
<PRE>key = ngetchx ();
</PRE>
<P>Sometimes, you will not get even a warning. Look the following example:</P>
<PRE>void *qptr = kbd_queue;
</PRE>
<P>The intention was probably to put the address of the keyboard queue into the <CODE>'qptr'</CODE>
variable, but instead, the address of the function <A HREF="system.html#kbd_queue">kbd_queue</A>
itself will be taken! As the function name is converted to a pointer to a function, and as you
assign it to a void pointer (which is assign-compatible with all other pointer types), you will
not get even a warning!
</TD></TR></TABLE></P>

<H3><A NAME="48"><U>How can I detect the hardware version of the calculator?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
Does any method exists for detecting hardware release of the calculator?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
I can now recommend the use of
<A HREF="flash.html#FL_getHardwareParmBlock">FL_getHardwareParmBlock</A>.
However, if you ask it for detecting hardware version before using grayscale routines,
you need not to do it because the <A HREF="gray.html#GrayOn">GrayOn</A> routine now performs an
autodetection by itself.
</TD></TR></TABLE></P>

<H3><A NAME="65"><U>How can I use very large integers like TIOS?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
I need to know more about how the TIOS stores and references big integers.
In other words, what would be the C structure that would be used to represent
any arbitrarily-long binary integer? In addition, I am particularly interested
about how two extermely long binary integers would be multiplied and
divided. Does TIOS have its own binary multiplication routine somewhere in the
ROM? Something that works similarly to BCD multiplication/division, I'm guessing?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
TIOS stores all integers (both small and large) in the following format (looking from
lower to higher addresses):</P>
<OL>
<LI><P>Bytes of the integer in little endian (up to 255 bytes);</P></LI>
<LI><P>The number of bytes occupied by integer (one byte);</P></LI>
<LI><P><A HREF="estack.html#POSINT_TAG">POSINT_TAG</A> or <A HREF="estack.html#NEGINT_TAG">NEGINT_TAG</A>,
depending on the sign.</P></LI>
</OL>
<P>These integers are kept on the expression stack, or in TI-Basic
variables (of course, in TI-Basic variables, there are two extra bytes
at the begining, which represents the length of a variable). In other
words, integers are kept in a structure which is similar to the
<A HREF="rsa.html#BN">BN</A> structure defined in the <A HREF="rsa.html">rsa.h</A>
header file, except the length byte is at the end, not at the begining (because
data on the expression stack is always in RPN). So, such a structure can't be
strictly represented using valid C syntax, because it requires something like</P>
<PRE>struct big_int
  {
    BYTE data[size];   // <I>but 'size' is not known in advance</I>
    BYTE size;
    BYTE tag;
  }
</PRE>
<P>Routines for multiplying and dividing very long integers surely exist in the TIOS,
but the strange fact is that such routines are not in the TIOS jump table (read: they
are not usable). Anyway, you can always use general eveluating routines
like <A HREF="estack.html#NG_rationalESI">NG_rationalESI</A> and
<A HREF="estack.html#NG_approxESI">NG_approxESI</A>. For example, to multiply two
very-long-integers, you can use the following template:</P>
<PRE><I>push two very-long-ints on the estack</I>
push_quantum (MULT_TAG);
NG_approxESI (top_estack);
</PRE>
<P>However, two routines for working with long integers <B>are</B> in TIOS jump table:
for calculating <CODE>'(A*B)%N'</CODE> and <CODE>'(A^B)%N'</CODE> where "%" is the "modulus" operation,
and "^" is "raising to a power". These operations are used in the
RSA cryptosystem. Both of them are defined in the <A HREF="rsa.html">rsa.h</A> header file. They
may be used for multiplying and raising to a power: you always can set <CODE>N</CODE> to very a big
number, then <CODE>(A*B)%N&nbsp;=&nbsp;A*B</CODE>. Also, you can use them for calculating modulus
(if you set <CODE>B</CODE> to 1). But, I am not sure how you can simulate division. I
think that TI never uses integer division: everything like <CODE>'A/B'</CODE> is kept as
a fraction, except in approx mode; TIOS then uses <A HREF="estack.html#NG_approxESI">NG_approxESI</A>.
</TD></TR></TABLE></P>

<H3><A NAME="66"><U>I need the gotoxy() function to port PC programs to the calculator...</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
In addition to functions from <A HREF="stdio.html">stdio.h</A> header file, I need
<B>gotoxy</B> function to allow porting some PC programs to TI...
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
All printing functions from <A HREF="stdio.html">stdio.h</A> are sensitive to
<A HREF="graph.html#MoveTo">MoveTo</A> command, so it is not hard to set print position
to anywhere. If you need just <B>gotoxy</B>, it is impossible for 4x6 font,
because it is proportional. But, for 6x8 and 8x10 fonts, it may be implemented
trivially:</P>
<PRE>#define gotoxy(x,y) MoveTo (6*x-6,8*y-8)    // <I>for 6x8 font</I>
#define gotoxy(x,y) MoveTo (8*x-8,10*y-10)  // <I>for 8x10 font</I>
</PRE>
<P>Here I assumed that top-left corner is (1,1) as on PC. Note that you MUST NOT put a space
between gotoxy and left bracket (else the preprocessor will define an argument-less macro).
You can also define an universal <B>gotoxy</B> macro which will work regardless of current font
setting, using smart GNU C macros:</P>
<PRE>#define gotoxy(x,y) \
  ({short __f=2*FontGetSys(); MoveTo((4+__f)*(x-1),(6+__f)*(y-1));})
</PRE>
<P>You will not be able to understand this if you are not familiar with
<A HREF="gnuexts.html">GNU extensions</A>.
</TD></TR></TABLE></P>

<H3><A NAME="49"><U>How can I create a program that is bigger than 24K and works on AMS 2.xx?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
How I can make a program which does not need any kernel, but which
is greater than 8K and which works on AMS 2.03 as well (or greater than 24K and which works
on AMS 2.04 and AMS 2.05 as well)?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
In fact, you need to make a short program (a so-called "launcher") which will call the main
program, bypassing the TIOS (to skip the software protection). If the main program is
"example.c", I recommend the following "launcher":</P>
<PRE>// Launcher for program called &quot;example&quot;

#define USE_TI89
#define USE_TI92PLUS
#define USE_V200

#include &lt;tigcclib.h&gt;

#define fatal(s) ({ST_showHelp (s); return;})

void _main (void)
{
  char *fptr, *cptr;
  unsigned short plen;
  SYM_ENTRY *SymPtr = DerefSym (SymFind (SYMSTR (&quot;example&quot;)));
  HANDLE h;
  if (!SymPtr) fatal (&quot;Program not found&quot;);
  h = SymPtr-&gt;handle;
  if (HeapGetLock (h))
    {
      cptr = fptr = HeapDeref (h);
      h = 0;
    }
  else
    {
      cptr = fptr = HLock (h);
    }
  plen = *(short*)(cptr) + 3;
  if (SymPtr-&gt;flags.bits.archived)
    {
      if (!(cptr = malloc (plen)))
        {
          if (h) HeapUnlock (h);
          fatal (&quot;Out of memory&quot;);
        }
      memcpy (cptr, fptr, plen);
    }
  enter_ghost_space ();
  EX_patch (cptr + 0x40002, cptr + plen + 0x3FFFE);
  ASM_call (cptr + 0x40002);
  if (h) HeapUnlock (h);
  if (cptr != fptr) free (cptr);
}
</PRE>
<P>If you are not an expert, use this program as-is.
<BR><BR>
For anybody who wants to know more about the 8K limit: on HW1 calcs it is a pure software
limit which can be broken by intercepting some error traps (used in PreOS),
or by making a short launcher which relocates the called program and jumps to it bypassing
the TIOS check. This is what I used. But, yet another problem must be solved: HW2. Namely, it
has built-in a hardware device which does not allow that PC can be out of certain zone,
so the launcher itself will not help. This device can't be turned off normally by
software, but Julien Muchembled found a "hole" in the protection system which allows
turning out this device (this is what his HW2 patch does): this is a very nasty
method, and I don't want to explain this here. But, this protection device can be fooled in a
simple way: it protects only the "normal" RAM address space (i.e. the first 256K of RAM). As
RAM is partially decoded, address x and x+256K are the same for TI-89, but if you jump to
x+256K instead of x, the protection will not be activated! Look at the launcher to see how
it works, and you now can understand why I added 0x40000 (i.e. 256K) to the address in two
places. First, I relocate the called program as it is located on x+256K instead of x,
then I call the subroutine on x+256K instead of x.
<BR><BR>
AMS 2.04 and AMS 2.05 introduce yet another level of protection (which existed before, but
caused problems very seldomly): on these AMS versions, even jumping
to the "ghost address space" (above 256K) is not possible if the program counter is out
of a certain area. (This caused the so-called "second launch crash"; if you have AMS 2.05 with
any longer program like TI-Chess, you probably know what I am talking about.) That's why I
introcuced a new function called
<A HREF="system.html#enter_ghost_space">enter_ghost_space</A>: its only purpose is to
smoothly bypass this new protection. Note that
<A HREF="system.html#enter_ghost_space">enter_ghost_space</A> is
deprecated now; you should use the
<CODE><A HREF="httigcc.html#advanced_ghostspace">EXECUTE_IN_GHOST_SPACE</A></CODE>
directive instead in most cases.
</TD></TR></TABLE></P>

<H3><A NAME="102"><U>What might be the reason for my program leaking a small amout of memory?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
My program is leaking some small amount of memory (less than 100 bytes). Where could my leak possibly be?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
The reason is probably the home screen history. Press F1 and 8 before and
after running your program, and if it is still leaking memory
then you need to be concerned.
</TD></TR></TABLE></P>

<H3><A NAME="103"><U>What is an &quot;Address Error&quot;?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
What kind of error in my program usually causes an "Address Error"?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Well, writing over the boundaries of an array can usually cause all sorts of
errors, since it usually destroys code or the return address of the function.
However, an "Address Error" actually means that a short or long value is read
or written at an odd address. So if you get an "Address Error" while you are
dealing with pointers, check that you do not cast an odd address to a pointer
to a short or long integer.
</TD></TR></TABLE></P>

<H3><A NAME="104"><U>Why does my program using dialog boxes crash?</U></A></H3>
<P><TABLE CELLPADDING="4"><TR><TD VALIGN="TOP"><B>Q:</B></TD><TD>
What causes my archived program using dialog boxes and/or the catalog to crash?
</TD></TR><TR><TD VALIGN="TOP"><B>A:</B></TD><TD>
Many things can cause programs to crash. However, archived programs using dialog boxes often 
crash due to special problems. Defining
<CODE><A HREF="httigcc.html#advanced_fileinuse">SET_FILE_IN_USE_BIT</A></CODE>
may solve the problem.
</TD></TR></TABLE></P>

<HR>
<H3><A HREF="index.html">Return to the main index</A></H3>
</BODY>
</HTML>
